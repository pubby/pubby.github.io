<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Copyright (c) 2023, Pubby">
<title>NESFab</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>NESFab</h1>
<div class="details">
<span id="author" class="author">Copyright (c) 2023, Pubby</span><br>
<span id="revdate">Version 0.2</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about_this_document">1. About this Document</a></li>
<li><a href="#_what_is_nesfab">2. What is NESFab?</a>
<ul class="sectlevel2">
<li><a href="#_strengths_of_nesfab">2.1. Strengths of NESFab</a></li>
<li><a href="#_weaknesses_of_nesfab">2.2. Weaknesses of NESFab</a></li>
</ul>
</li>
<li><a href="#_quirks_and_surprises">3. Quirks and Surprises</a>
<ul class="sectlevel2">
<li><a href="#_types_and_values">3.1. Types and Values</a></li>
<li><a href="#_operators">3.2. Operators</a></li>
</ul>
</li>
<li><a href="#_getting_started">4. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_installation">4.1. Installation</a></li>
<li><a href="#firstrom">4.2. Compiling your first ROM</a></li>
<li><a href="#_your_first_configuration_file">4.3. Your first configuration file</a></li>
<li><a href="#_included_examples">4.4. Included Examples</a></li>
<li><a href="#_other_resources">4.5. Other Resources</a></li>
</ul>
</li>
<li><a href="#config">5. Configuration Options</a>
<ul class="sectlevel2">
<li><a href="#_comments">5.1. Comments</a></li>
<li><a href="#_help_h">5.2. <code>help</code> (<code>-h</code>)</a></li>
<li><a href="#_version_v">5.3. <code>version</code> (<code>-v</code>)</a></li>
<li><a href="#_input_i">5.4. <code>input</code> (<code>-i</code>)</a></li>
<li><a href="#_output_o">5.5. <code>output</code> (<code>-o</code>)</a></li>
<li><a href="#codedir">5.6. <code>code-dir</code> (<code>-I</code>)</a></li>
<li><a href="#_resource_dir_r">5.7. <code>resource-dir</code> (<code>-R</code>)</a></li>
<li><a href="#mapperopt">5.8. <code>mapper</code> (<code>-M</code>)</a></li>
<li><a href="#mirroringopt">5.9. <code>mirroring</code> (<code>-m</code>)</a></li>
<li><a href="#prgopt">5.10. <code>prg-size</code> (<code>-p</code>)</a></li>
<li><a href="#chropt">5.11. <code>chr-size</code> (<code>-c</code>)</a></li>
<li><a href="#opt_system">5.12. <code>system</code> (<code>-S</code>)</a></li>
<li><a href="#_threads_j">5.13. <code>threads</code> (<code>-j</code>)</a></li>
<li><a href="#_error_on_warning_w">5.14. <code>error-on-warning</code> (<code>-W</code>)</a></li>
<li><a href="#_pause">5.15. <code>pause</code></a></li>
</ul>
</li>
<li><a href="#mappers">6. Supported Mappers</a></li>
<li><a href="#value_semantics">7. Value Semantics</a></li>
<li><a href="#_indentation">8. Indentation</a></li>
<li><a href="#banks">9. Banks</a></li>
<li><a href="#groups">10. Groups</a></li>
<li><a href="#_comments_2">11. Comments</a>
<ul class="sectlevel2">
<li><a href="#_single_line_comments">11.1. Single-Line Comments</a></li>
<li><a href="#_multi_line_comments">11.2. Multi-Line Comments</a></li>
</ul>
</li>
<li><a href="#byte_blocks">12. Byte Blocks</a>
<ul class="sectlevel2">
<li><a href="#byte_blocks_typed_data">12.1. Typed Data</a></li>
<li><a href="#byte_blocks_untyped_data">12.2. Untyped Data</a></li>
<li><a href="#_assembly_instructions">12.3. Assembly Instructions</a></li>
<li><a href="#_special_statements">12.4. Special Statements</a></li>
</ul>
</li>
<li><a href="#_keywords">13. Keywords</a>
<ul class="sectlevel2">
<li><a href="#_if">13.1. <code>if</code></a></li>
<li><a href="#_else">13.2. <code>else</code></a></li>
<li><a href="#kw_while">13.3. <code>while</code></a></li>
<li><a href="#kw_for">13.4. <code>for</code></a></li>
<li><a href="#kw_do">13.5. <code>do</code></a></li>
<li><a href="#kw_break">13.6. <code>break</code></a></li>
<li><a href="#_continue">13.7. <code>continue</code></a></li>
<li><a href="#kw_switch">13.8. <code>switch</code></a>
<ul class="sectlevel3">
<li><a href="#kw_switch_asm">13.8.1. <code>switch</code> statement (byte block)</a></li>
</ul>
</li>
<li><a href="#kw_case">13.9. <code>case</code></a></li>
<li><a href="#kw_default">13.10. <code>default</code></a></li>
<li><a href="#kw_goto">13.11. <code>goto</code></a>
<ul class="sectlevel3">
<li><a href="#kw_goto_statement">13.11.1. <code>goto</code> statement</a></li>
<li><a href="#kw_goto_mode_statement">13.11.2. <code>goto mode</code> statement</a></li>
<li><a href="#kw_goto_asm">13.11.3. <code>goto</code> (assembly byte block)</a></li>
<li><a href="#kw_goto_mode_asm">13.11.4. <code>goto mode</code> (assembly byte block)</a></li>
</ul>
</li>
<li><a href="#kw_label">13.12. <code>label</code></a>
<ul class="sectlevel3">
<li><a href="#kw_label_asm">13.12.1. <code>label</code> statement (byte block)</a></li>
</ul>
</li>
<li><a href="#kw_return">13.13. <code>return</code></a>
<ul class="sectlevel3">
<li><a href="#kw_return_statement">13.13.1. <code>return</code> statement</a></li>
<li><a href="#kw_return_expression">13.13.2. <code>return</code> expression</a></li>
</ul>
</li>
<li><a href="#kw_fence">13.14. <code>fence</code></a></li>
<li><a href="#kw_true">13.15. <code>true</code></a></li>
<li><a href="#kw_false">13.16. <code>false</code></a></li>
<li><a href="#kw_ready">13.17. <code>ready</code></a></li>
<li><a href="#kw_state">13.18. <code>state</code></a>
<ul class="sectlevel3">
<li><a href="#_state_read">13.18.1. <code>state</code> read</a></li>
<li><a href="#_state_write">13.18.2. <code>state</code> write</a></li>
</ul>
</li>
<li><a href="#kw_system">13.19. <code>system</code></a>
<ul class="sectlevel3">
<li><a href="#kw_system_ntsc">13.19.1. <code>SYSTEM_NTSC</code></a></li>
<li><a href="#kw_system_pal">13.19.2. <code>SYSTEM_PAL</code></a></li>
<li><a href="#kw_system_dendy">13.19.3. <code>SYSTEM_DENDY</code></a></li>
<li><a href="#kw_system_unknown">13.19.4. <code>SYSTEM_UNKNOWN</code></a></li>
</ul>
</li>
<li><a href="#kw_ppu_regs">13.20. PPU Registers</a>
<ul class="sectlevel3">
<li><a href="#kw_ppuctrl">13.20.1. <code>PPUCTRL</code></a></li>
<li><a href="#kw_ppumask">13.20.2. <code>PPUMASK</code></a></li>
<li><a href="#kw_ppustatus">13.20.3. <code>PPUSTATUS</code></a></li>
<li><a href="#kw_oamaddr">13.20.4. <code>OAMADDR</code></a></li>
<li><a href="#kw_oamdata">13.20.5. <code>OAMDATA</code></a></li>
<li><a href="#kw_ppuscroll">13.20.6. <code>PPUSCROLL</code></a></li>
<li><a href="#kw_ppuaddr">13.20.7. <code>PPUADDR</code></a></li>
<li><a href="#kw_ppudata">13.20.8. <code>PPUDATA</code></a></li>
<li><a href="#kw_oamdma">13.20.9. <code>OAMDMA</code></a></li>
</ul>
</li>
<li><a href="#kw_fn">13.21. <code>fn</code></a>
<ul class="sectlevel3">
<li><a href="#kw_fn_asm">13.21.1. <code>fn</code> statement (assembly byte block)</a></li>
</ul>
</li>
<li><a href="#kw_ct">13.22. <code>ct</code></a>
<ul class="sectlevel3">
<li><a href="#_ct_fn">13.22.1. <code>ct fn</code></a></li>
<li><a href="#_ct_value">13.22.2. <code>ct</code> value</a></li>
</ul>
</li>
<li><a href="#kw_mode">13.23. <code>mode</code></a></li>
<li><a href="#kw_nmi">13.24. <code>nmi</code></a>
<ul class="sectlevel3">
<li><a href="#kw_nmi_statement">13.24.1. <code>nmi</code> statement</a></li>
<li><a href="#kw_nmi_asm">13.24.2. <code>nmi</code> statement (byte block)</a></li>
<li><a href="#kw_nmi_function">13.24.3. <code>nmi</code> function</a></li>
</ul>
</li>
<li><a href="#kw_asm">13.25. <code>asm</code></a></li>
<li><a href="#kw_struct">13.26. <code>struct</code></a></li>
<li><a href="#kw_vars">13.27. <code>vars</code></a></li>
<li><a href="#kw_data">13.28. <code>data</code></a></li>
<li><a href="#kw_omni">13.29. <code>omni</code></a></li>
<li><a href="#kw_charmap">13.30. <code>charmap</code></a></li>
<li><a href="#_chrrom">13.31. <code>chrrom</code></a></li>
<li><a href="#kw_file">13.32. <code>file</code></a>
<ul class="sectlevel3">
<li><a href="#file_bin">13.32.1. Binary file formats</a></li>
<li><a href="#file_txt">13.32.2. <code>.txt</code> format</a></li>
<li><a href="#file_png">13.32.3. <code>.png</code> format</a></li>
<li><a href="#file_raw">13.32.4. <code>raw</code> target</a></li>
<li><a href="#file_fmt">13.32.5. <code>fmt</code> target</a></li>
<li><a href="#file_pbz">13.32.6. <code>pbz</code> target</a></li>
<li><a href="#file_rlz">13.32.7. <code>rlz</code> target</a></li>
</ul>
</li>
<li><a href="#kw_audio">13.33. <code>audio</code></a>
<ul class="sectlevel3">
<li><a href="#audio_puf1_music">13.33.1. <code>puf1_music</code> target</a></li>
<li><a href="#audio_puf1_sfx">13.33.2. <code>puf1_sfx</code> target</a></li>
</ul>
</li>
<li><a href="#kw_stows">13.34. <code>stows</code></a></li>
<li><a href="#kw_employs">13.35. <code>employs</code></a></li>
</ul>
</li>
<li><a href="#modifiers">14. Modifiers</a>
<ul class="sectlevel2">
<li><a href="#mod_flags">14.1. Modifier Flags</a></li>
<li><a href="#mod_stows">14.2. <code>stows</code></a></li>
<li><a href="#mod_employs">14.3. <code>employs</code></a></li>
<li><a href="#mod_preserves">14.4. <code>preserves</code></a></li>
<li><a href="#mod_data">14.5. <code>data</code></a></li>
<li><a href="#mod_vars">14.6. <code>vars</code></a></li>
</ul>
</li>
<li><a href="#_operators_2">15. Operators</a>
<ul class="sectlevel2">
<li><a href="#_operator_tables">15.1. Operator Tables</a>
<ul class="sectlevel3">
<li><a href="#unary_ops">15.1.1. Unary Operators</a></li>
<li><a href="#binop">15.1.2. Binary Operators</a></li>
<li><a href="#fnop">15.1.3. Function-like Operators</a></li>
</ul>
</li>
<li><a href="#_operator_listings">15.2. Operator Listings</a>
<ul class="sectlevel3">
<li><a href="#get_pointer">15.2.1. Get Pointer <code>@</code></a></li>
<li><a href="#get_hw_addr">15.2.2. Get Hardware Address <code>&amp;</code></a></li>
<li><a href="#unary_plus">15.2.3. Unary Plus <code>+</code></a></li>
<li><a href="#unary_negate">15.2.4. Unary Negate <code>-</code></a></li>
<li><a href="#unary_bitwise_not">15.2.5. Unary Bitwise NOT <code>~</code></a></li>
<li><a href="#unary_logical_not">15.2.6. Unary Logical NOT <code>!</code></a></li>
<li><a href="#member_access">15.2.7. Member Access <code>.</code></a></li>
<li><a href="#multiply">15.2.8. Multiply <code>*</code></a></li>
<li><a href="#assign_multiply">15.2.9. Assign by Multiply (<code>*=</code>)</a></li>
<li><a href="#add">15.2.10. Add <code>+</code></a></li>
<li><a href="#assign_add">15.2.11. Assign by Add <code>+=</code></a></li>
<li><a href="#subtract">15.2.12. Subtract <code>-</code></a></li>
<li><a href="#assign_subtract">15.2.13. Assign by Subtract <code>-=</code></a></li>
<li><a href="#rotate_left">15.2.14. Rotate Left <code>&lt;-&lt;</code></a></li>
<li><a href="#assign_rotate_left">15.2.15. Assign by Rotate Left <code>&lt;=&lt;</code></a></li>
<li><a href="#rotate_right">15.2.16. Rotate Right <code>&gt;-&gt;</code></a></li>
<li><a href="#assign_rotate_right">15.2.17. Assign by Rotate Right <code>&gt;=&gt;</code></a></li>
<li><a href="#shift_left">15.2.18. Shift Left <code>&lt;&lt;</code></a></li>
<li><a href="#assign_shift_left">15.2.19. Assign by Shift Left <code>&lt;&lt;=</code></a></li>
<li><a href="#shift_right">15.2.20. Shift Right <code>&gt;&gt;</code></a></li>
<li><a href="#assign_shift_right">15.2.21. Assign by Shift Right <code>&gt;&gt;=</code></a></li>
<li><a href="#bitwise_and">15.2.22. Bitwise AND <code>&amp;</code></a></li>
<li><a href="#assign_bitwise_and">15.2.23. Assign by Bitwise AND <code>&amp;=</code></a></li>
<li><a href="#bitwise_xor">15.2.24. Bitwise XOR <code>^</code></a></li>
<li><a href="#assign_bitwise_xor">15.2.25. Assign by Bitwise XOR <code>^=</code></a></li>
<li><a href="#bitwise_or">15.2.26. Bitwise OR <code>|</code></a></li>
<li><a href="#assign_bitwise_or">15.2.27. Assign by Bitwise OR <code>|=</code></a></li>
<li><a href="#logical_and">15.2.28. Logical AND <code>&amp;&amp;</code></a></li>
<li><a href="#logical_or">15.2.29. Logical OR <code>||</code></a></li>
<li><a href="#less_than">15.2.30. Less Than <code>&lt;</code></a></li>
<li><a href="#less_than_or_equal_to">15.2.31. Less Than or Equal To <code>&lt;=</code></a></li>
<li><a href="#greater_than">15.2.32. Greater Than <code>&gt;</code></a></li>
<li><a href="#greater_than_or_equal_to">15.2.33. Greater Than or Equal To <code>&gt;=</code></a></li>
<li><a href="#equal_to">15.2.34. Equal To <code>==</code></a></li>
<li><a href="#not_equal_to">15.2.35. Not Equal To <code>!=</code></a></li>
<li><a href="#assign">15.2.36. Assign <code>=</code></a></li>
</ul>
</li>
<li><a href="#array_access">15.3. Array and pointer access</a>
<ul class="sectlevel3">
<li><a href="#array_access_u">15.3.1. <code>[]</code> U-indexed access</a></li>
<li><a href="#array_access_uu">15.3.2. <code>{}</code> UU-indexed access</a></li>
</ul>
</li>
<li><a href="#_hardware_operators">15.4. Hardware operators</a>
<ul class="sectlevel3">
<li><a href="#hw_read">15.4.1. <code>{}()</code> Hardware read</a></li>
<li><a href="#hw_write">15.4.2. <code>{}()</code> Hardware write</a></li>
</ul>
</li>
<li><a href="#fn_call">15.5. Function calls</a></li>
<li><a href="#sizeof">15.6. <code>sizeof</code></a>
<ul class="sectlevel3">
<li><a href="#sizeof_type">15.6.1. <code>sizeof</code> Type</a></li>
<li><a href="#sizeof_expr">15.6.2. <code>sizeof</code>(expression)</a></li>
</ul>
</li>
<li><a href="#len">15.7. <code>len</code></a>
<ul class="sectlevel3">
<li><a href="#len_type">15.7.1. <code>len</code> Type</a></li>
<li><a href="#len_expr">15.7.2. <code>len</code>(expression)</a></li>
</ul>
</li>
<li><a href="#casts">15.8. Explicit Type Casts</a>
<ul class="sectlevel3">
<li><a href="#_zero_initializations">15.8.1. Zero Initializations</a></li>
<li><a href="#_array_fills">15.8.2. Array Fills</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_literals">16. Literals</a>
<ul class="sectlevel2">
<li><a href="#_boolean_literals">16.1. Boolean Literals</a></li>
<li><a href="#_numeric_literals">16.2. Numeric Literals</a></li>
<li><a href="#_string_and_character_literals">16.3. String and Character Literals</a>
<ul class="sectlevel3">
<li><a href="#_syntax_and_semantics">16.3.1. Syntax and Semantics</a></li>
<li><a href="#_escape_sequences">16.3.2. Escape Sequences</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_types">17. Types</a>
<ul class="sectlevel2">
<li><a href="#_scalar_types">17.1. Scalar Types</a>
<ul class="sectlevel3">
<li><a href="#type_integer">17.1.1. Integer Types</a></li>
<li><a href="#_unit_fractional_types">17.1.2. Unit-Fractional Types</a></li>
<li><a href="#type_fixed">17.1.3. Fixed-point Types</a></li>
<li><a href="#_numeric_constant_types">17.1.4. Numeric Constant Types</a></li>
<li><a href="#type_bool">17.1.5. Bool</a></li>
<li><a href="#_void">17.1.6. Void</a></li>
</ul>
</li>
<li><a href="#type_arithmetic">17.2. Arithmetic Types</a></li>
<li><a href="#type_quantity">17.3. Quantity Types</a>
<ul class="sectlevel3">
<li><a href="#type_ptr">17.3.1. Pointer Types</a></li>
<li><a href="#type_address">17.3.2. Address Types</a></li>
</ul>
</li>
<li><a href="#_arrays">17.4. Arrays</a>
<ul class="sectlevel3">
<li><a href="#type_tea">17.4.1. Typed Element Arrays (TEAs)</a></li>
<li><a href="#type_paa">17.4.2. Pointer-Addressable Arrays (PAAs)</a></li>
</ul>
</li>
<li><a href="#type_struct">17.5. Structures</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_about_this_document">1. About this Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This documentation is for <a href="http://pubby.games/nesfab.html">NESFab</a>.
It is currently a work in progress, so comments and contributions are welcome.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Question can be asked on the <a href="https://discord.gg/RUrYmC5ZeE">Discord</a> or via <a href="https://pubby.games/email.png">email</a>.</p>
</li>
<li>
<p>Changes can be submitted it via the <a href="https://github.com/pubby/nesfab">Github</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_nesfab">2. What is NESFab?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NESFab is a statically-typed, procedural programming language for creating NES games.
Designed with 8-bit limitations in mind, the language is more ergonomic to use than C, while also producing faster assembly code.
It&#8217;s easy to get started with, and has a useful set of libraries for making your first&#8201;&#8212;&#8201;or hundredth&#8201;&#8212;&#8201;NES game.</p>
</div>
<div class="sect2">
<h3 id="_strengths_of_nesfab">2.1. Strengths of NESFab</h3>
<div class="ulist">
<ul>
<li>
<p>Performance is generally superior to C and all other compiled langauges.</p>
</li>
<li>
<p><a href="#mappers">Mapper</a> banks are handled automatically and scale up without fuss.</p>
</li>
<li>
<p>Multi-byte and fixed-point arithmetic is well supported and simpler than other languages.</p>
</li>
<li>
<p>The compiler is easily configured, without needing complex build systems.</p>
</li>
<li>
<p>Some asset loading is built-in. There are less steps to get your ideas onto the screen.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_weaknesses_of_nesfab">2.2. Weaknesses of NESFab</h3>
<div class="ulist">
<ul>
<li>
<p>NESFab code is only compatible with the NES. It cannot compile to other systems.</p>
</li>
<li>
<p>Only a select number of cartridge <a href="#mappers">mappers</a> are supported.</p>
</li>
<li>
<p>Although NESFab performance is good, writing assembly by hand can obviously surpass it.</p>
</li>
<li>
<p>NESFab is not as tried-and-true as other languages. They are likely bugs and missing features.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quirks_and_surprises">3. Quirks and Surprises</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re coming from another language, you might be surprised by a few of NESFab&#8217;s quirks.
The most flagrant ones are listed below.</p>
</div>
<div class="sect2">
<h3 id="_types_and_values">3.1. Types and Values</h3>
<div class="ulist">
<ul>
<li>
<p>Like C, everything is passed by <a href="#value_semantics">value</a>. Nothing is passed by reference.</p>
</li>
<li>
<p>While arrays are supported, multi-dimensional arrays are not.</p>
</li>
<li>
<p>Most values cannot be addressed via pointers.
Instead, only global variables of a <a href="#type_paa">specific type</a> can be addressed.</p>
</li>
<li>
<p>Global variables and data are partitioned into used-defined <a href="#groups">groups</a>; a concept unique to NESFab.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_operators">3.2. Operators</h3>
<div class="ulist">
<ul>
<li>
<p>The operators <code>&amp;</code>, <code>|</code>, and <code>^</code> have a <a href="#binop">higher precedence</a> than in C.</p>
</li>
<li>
<p>Combined-assignment operators, like <code>+=</code> or <code>&lt;&#8656;</code>, return a value of type <code>Bool</code>, representing the carry.</p>
</li>
<li>
<p>Division is unsupported.</p>
</li>
<li>
<p>Array operators (<code>[]</code> and <code>{}</code>) are split into 8-bit and 16-bit versions, with the 8-bit versions having better performance.</p>
</li>
<li>
<p>Types are not implicitly promoted. Different operators have different rules for how differing types are handled.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">4. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation">4.1. Installation</h3>
<div class="paragraph">
<p>NESFab is available on <a href="https://github.com/pubby/nesfab">Github</a>.
It is best to build it from scratch, but if that is not possible, download one of the <a href="https://github.com/pubby/nesfab/releases">releases</a>.
On Unix systems, is recommended to place the <code>nesfab</code> executable in a directory your <code>PATH</code> variable searches.
On Linux, this is typically <code>/usr/bin</code>, while on Mac, it is typically <code>/usr/local/bin</code>.</p>
</div>
<div class="paragraph">
<p>You will also want a NES emulator with debugging features, like
<a href="https://fceux.com/">FCEUX</a>, <a href="https://www.mesen.ca/">Mesen</a>, or <a href="https://www.qmtpro.com/~nes/nintendulator/">Nintendulator</a>.
It is often beneficial to test on multiple emulators, so there is no shame in downloading them all.</p>
</div>
<div class="paragraph">
<p>Syntax highlighting support can be found in the <code>syntax_highlighting</code> directory of repository.
If your text editor is not supported, consider writing one yourself and submitting it to the repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="firstrom">4.2. Compiling your first ROM</h3>
<div class="paragraph">
<p>The <code>nesfab</code> tool compiles <code>.fab</code> source code files into <code>.nes</code> ROMs.
It can be used with the command-line, or by clicking and dragging the file you want to compile onto the <code>nesfab</code> executable.</p>
</div>
<div class="paragraph">
<p>To compile your first ROM, create a file called <code>main.fab</code> and save it with code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// This small program plays a sound effect.

// Variables:
vars /sound
    UU pitch = 1000

// Sends 'pitch' variable to the APU, emitting sound:
fn play_sound()
    {$4015}(%100)
    {$4008}($FF)
    {$400A}(pitch.a)
    {$400B}(pitch.b &amp; %111)

mode main()
    {$2000}(%10000000)
    while true
        pitch *= 1.01
        play_sound()
        nmi</pre>
</div>
</div>
<div class="paragraph">
<p>If using the command-line, you can compile it using the command:</p>
</div>
<div class="paragraph">
<p><code>nesfab main.fab</code></p>
</div>
<div class="paragraph">
<p>Otherwise, drag the <code>main.fab</code> file onto the <code>nesfab</code> executable.</p>
</div>
<div class="paragraph">
<p>When done, the compiler should have produced an <code>a.nes</code> file in the same directory,
which is the default name of compiled binaries.
Try running <code>a.nes</code> in your NES emulator.
You should hear a sweeping tone being played.</p>
</div>
</div>
<div class="sect2">
<h3 id="_your_first_configuration_file">4.3. Your first configuration file</h3>
<div class="paragraph">
<p>The <code>nesfab</code> compiler accepts options both on the command-line, and via configuration files.
For most projects, a single configuration file is ideal, so this section will focus on that.</p>
</div>
<div class="paragraph">
<p>Below is an example configuration file: <code>hello_world.cfg</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>output = hello_world.nes
input = main.fab</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>output</code> option determines the name of the <code>.nes</code> file, while <code>input</code> lists a single source file.</p>
</div>
<div class="paragraph">
<p>To compile using this configuration file, either run:</p>
</div>
<div class="paragraph">
<p><code>nesfab hello_world.cfg</code></p>
</div>
<div class="paragraph">
<p>Or drag the <code>hello_world.cfg</code> file onto the <code>nesfab</code> executable.</p>
</div>
<div class="paragraph">
<p>It should produce the same result as <a href="#firstrom">before</a>, but the ROM will be saved as <code>hello_world.nes</code> instead of <code>a.nes</code>
because the <code>output</code> option was set.</p>
</div>
<div class="paragraph">
<p>For more details about configuration files, see the <a href="#config">config reference page</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_included_examples">4.4. Included Examples</h3>
<div class="paragraph">
<p>Project examples can be found in the <code>examples/</code> directory of the repository.
To build each example, compile their <code>*.cfg</code> files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_resources">4.5. Other Resources</h3>
<div class="paragraph">
<p>The best site for learning to program the NES is <a href="https://www.nesdev.org/">NESDev</a>,
along with its <a href="https://www.nesdev.org/wiki/Nesdev_Wiki">wiki</a>.
A few of the most valuable pages are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.nesdev.org/wiki/CPU_memory_map">Memory Map</a></p>
</li>
<li>
<p><a href="https://www.nesdev.org/wiki/PPU_registers">PPU Registers</a></p>
</li>
<li>
<p><a href="https://www.nesdev.org/wiki/APU_registers">APU Registers</a></p>
</li>
<li>
<p><a href="https://www.nesdev.org/obelisk-6502-guide/reference.html">6502 Instruction Listings</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config">5. Configuration Options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_comments">5.1. Comments</h3>
<div class="paragraph">
<p>Comments in configuration files are specified as lines beginning with <code>#</code>.
Comments are used for documentation; they have no effect on the configuration.</p>
</div>
<div class="paragraph">
<p>Comments are not available on the command-line.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Hello world! This is a comment!</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_help_h">5.2. <code>help</code> (<code>-h</code>)</h3>
<div class="paragraph">
<p>Prints a list of command-line options.</p>
</div>
<div class="paragraph">
<p>This option is only available via the command-line.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --help</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_version_v">5.3. <code>version</code> (<code>-v</code>)</h3>
<div class="paragraph">
<p>Prints information about the NESFab executable, including its version history.</p>
</div>
<div class="paragraph">
<p>This option is only available via the command-line.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --version</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_i">5.4. <code>input</code> (<code>-i</code>)</h3>
<div class="paragraph">
<p>Specifies a file to be compiled, which can either be a source file with extension <code>.fab</code>,
or a configuration file with extension <code>.cfg</code>.
This option can be used multiple times to compile multiple files.</p>
</div>
<div class="paragraph">
<p>Note: the flags <code>--input</code> and <code>-i</code> are optional when using the command line,
as any argument not belonging to another option will be interpreted as an <code>input</code>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --input "file1.fab" --input "file2.fab" --input "another_config.cfg"</pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab "file1.fab" "file2.fab" "another_config.cfg"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>input = file1.fab
input = util/file2.fab
input = another_config.cfg</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_output_o">5.5. <code>output</code> (<code>-o</code>)</h3>
<div class="paragraph">
<p>Specifies the name of the executable <code>.nes</code> file the compiler will produce.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>By default, the value is <code>"a.nes"</code>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --output "game.nes"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>output = game.nes</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="codedir">5.6. <code>code-dir</code> (<code>-I</code>)</h3>
<div class="paragraph">
<p>Specifies a directory to be searched when compiling source code files.
This option can be used multiple times to specify multiple directories.</p>
</div>
<div class="paragraph">
<p>Commonly, this option is used when several source files exist in the same directory.
<code>code-dir</code> can specify this directory, then <code>input</code> can specify the files inside it
without having to reference the directory name.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --code-dir "some_directory/"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>code-dir = some_directory/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_dir_r">5.7. <code>resource-dir</code> (<code>-R</code>)</h3>
<div class="paragraph">
<p>Specifies a directory to be searched when importing data files.
This option can be used multiple times to specify multiple directories.</p>
</div>
<div class="paragraph">
<p>This behaves like <a href="#codedir"><code>code-dir</code></a>, but applies to the files imported by the <a href="#kw_file"><code>file</code> keyword</a>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --resource-dir "some_directory/"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource-dir = some_directory/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapperopt">5.8. <code>mapper</code> (<code>-M</code>)</h3>
<div class="paragraph">
<p>Specifies the mapper used. The argument is a <a href="#mappers">mapper name</a>.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>By default, the value is <code>nrom</code>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --mapper bnrom</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>mapper = bnrom</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mirroringopt">5.9. <code>mirroring</code> (<code>-m</code>)</h3>
<div class="paragraph">
<p>Specifies the mirroring used for <a href="#mappers">mappers with fixed mirrorings</a>.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>This option expects one argument. Any of the following arguments are valid:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vertical Mirroring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Horizontal Mirroring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-Way Mirroring</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the mapper supports multiple mirrorings, the default value is <code>V</code>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --mirroring H</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>mirroring = H</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prgopt">5.10. <code>prg-size</code> (<code>-p</code>)</h3>
<div class="paragraph">
<p>Specifies the size of PRG (the amount of memory for code) in increments of 1 KiB.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>The default value depends on the mapper.
These values correspond with common cartridge designs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name (HTML link)</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/NROM"><code>nrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/AxROM"><code>anrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/BNROM"><code>bnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/CNROM"><code>cnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GxROM"><code>gnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GTROM"><code>gtrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Just because the compiler accepts a <code>prg-size</code> does not mean that corresponding hardware exists in the real world.
Only the default size is asserted to be commonly available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --prg-size 128</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>prg-size = 128</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chropt">5.11. <code>chr-size</code> (<code>-c</code>)</h3>
<div class="paragraph">
<p>Specifies the size of CHR (the amount of memory for tilesets) in increments of 1 KiB.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>The default value depends on the mapper.
These values correspond with common cartridge designs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name (HTML link)</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/NROM"><code>nrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/AxROM"><code>anrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/BNROM"><code>bnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/CNROM"><code>cnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GxROM"><code>gnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GTROM"><code>gtrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Just because the compiler accepts a <code>chr-size</code> does not mean that corresponding hardware exists in the real world.
Only the default size is asserted to be commonly available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --chr-size 32</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>chr-size = 32</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="opt_system">5.12. <code>system</code> (<code>-S</code>)</h3>
<div class="paragraph">
<p>Specifies the target NES system, which will be accessible using the <a href="#kw_system"><code>system</code> keyword</a>.
This option can only be specified once.</p>
</div>
<div class="paragraph">
<p>By default, the value is <code>detect</code>.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --system ntsc</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>system = ntsc</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_ntsc"><code>ntsc</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/NTSC">USA and Japanese systems</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_pal"><code>pal</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/PAL">European systems</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_dendy"><code>dendy</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Dendy_(console)">Russian systems</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_unknown"><code>unknown</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>detect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detect system at runtime</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>detect</code> has a small runtime penalty.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_threads_j">5.13. <code>threads</code> (<code>-j</code>)</h3>
<div class="paragraph">
<p>Specifies how many threads the compiler can use, enabling parallel compilation.
This option expects an integer argument, and can only be specified once.</p>
</div>
<div class="paragraph">
<p>By default, the value is 1.</p>
</div>
<div class="paragraph">
<p>In general, a value slightly above the number of CPU cores available is ideal.
Performance may degrade if the number is too high.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This option is currently not supported on MinGW builds of NESFab,
due to that platform having a buggy implementation of threads.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --threads 4</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>threads = 4</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error_on_warning_w">5.14. <code>error-on-warning</code> (<code>-W</code>)</h3>
<div class="paragraph">
<p>This option turns warnings into errors and halts compilation whenever a warning occurs.
This option expects no arguments and can only be specified once.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --error-on-warning</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>error-on-warning = 1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pause">5.15. <code>pause</code></h3>
<div class="paragraph">
<p>This option pauses the compiler before exiting until input is received on stdin.
It is intended to be used on Microsoft Windows to keep the Command Prompt window open until you&#8217;re ready to close it.
This option expects no arguments.</p>
</div>
<div class="paragraph">
<p><strong>Command-line usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nesfab --pause</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>pause = 1</pre>
</div>
</div>
<div class="paragraph">
<p>To make NESFab always pause on Microsoft Windows, first create a shortcut to the NESFab executable.
Then, in the shortcut&#8217;s properties, put <code>--pause</code> after the target path.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mappers">6. Supported Mappers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NESFab supports a small set of <a href="https://www.nesdev.org/wiki/Mapper">mappers</a>,
which determine the capabilities of a cartridge.
The choice of mapper determines the amount of space available for code, the <a href="https://www.nesdev.org/wiki/Mirroring">nametable mirroring</a>, and <a href="https://www.nesdev.org/wiki/CHR_ROM_vs._CHR_RAM">whether CHR data is stored in RAM or ROM</a>.</p>
</div>
<div class="paragraph">
<p><strong>For beginners:</strong> It is recommended to start with <code>nrom</code> (the default),
and only consider switching once your program grows too large for it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The mapper names in the table below are links.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Max PRG (Code)</th>
<th class="tableblock halign-left valign-top">Max CHR (Tilesets)</th>
<th class="tableblock halign-left valign-top">Nametable VRAM</th>
<th class="tableblock halign-left valign-top">Mirroring</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/NROM"><code>nrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed H or V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/AxROM"><code>anrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 KiB (RAM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switchable 1-Page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/BNROM"><code>bnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8192 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 KiB (RAM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed H or V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/CNROM"><code>cnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed H or V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GxROM"><code>gnrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed H or V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.nesdev.org/wiki/GTROM"><code>gtrom</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 KiB (RAM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 KiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed 4</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For information on how to configure NESFab for a specific mapper, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mapperopt"><code>mapper</code> (<code>-M</code>)</a></p>
</li>
<li>
<p><a href="#mirroringopt"><code>mirroring</code> (<code>-m</code>)</a></p>
</li>
<li>
<p><a href="#prgopt"><code>prg-size</code> (<code>-p</code>)</a></p>
</li>
<li>
<p><a href="#chropt"><code>chr-size</code> (<code>-c</code>)</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="value_semantics">7. Value Semantics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Values in NESFab are always passed and stored by <a href="https://en.wikipedia.org/wiki/Value_type_and_reference_type">value, not by reference</a>.
This means that when you call a function, its parameters will be copies of the arguments passed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U x) U
    x += 5
    return x

fn bar()
    U y = 10
    U z = foo(y)</pre>
</div>
</div>
<div class="paragraph">
<p>At the end of <code>bar</code>, variable <code>y</code> will have the value <code>10</code>, while variable <code>z</code> will have the value <code>15</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_indentation">8. Indentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indentation refers to the spaces at the beginning of each line.
In NESFab, indentation is significant and alters the behavior of code.</p>
</div>
<div class="paragraph">
<p>Indentation is used to create <strong>code blocks</strong>, where every line but the first is indented using spaces (not tabs).
The amount of spaces is up to you, but it must be consistent throughout the block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FIRST LINE
    INDENTED LINE
    INDENTED LINE
    INDENTED LINE</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Code blocks</strong> can be nested:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FIRST BLOCK
    INDENTED LINE
    INDENTED LINE
    SECOND BLOCK
        INDENTED LINE
        INDENTED LINE
    THIRD BLOCK
        INDENTED LINE
        INDENTED LINE</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="banks">9. Banks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NES uses a 16-bit address space, but most games need more data than 16-bits can represent.
To overcome this limitation, machine code can be broken up into segments called "banks",
and hardware on the cartridge can switch between these banks at runtime.</p>
</div>
<div class="paragraph">
<p>In NESFab, banks are automatically handled for you, meaning you do not need to worry about them much.
However, it is still useful to know a bit about them, to clarify how things work under the hood.</p>
</div>
<div class="paragraph">
<p><strong>Pointers and Addressing: Implementation Details</strong></p>
</div>
<div class="paragraph">
<p>When banks are involved, rather than addressing using 16-bit pointers, 24-bit pointers are used instead.
A 24-bit pointer can be seen as a 16-bit address paired with an 8-bit integer representing the bank.</p>
</div>
<div class="paragraph">
<p>When dereferencing a 24-bit pointer,
first the bank is swapped into memory using the 8-bit integer,
then the data is read using the 16-bit address.
The caveat is, the machine code performing the dereference needs to be in memory too.
Depending on the <a href="#mappers">mapper</a>, this can involve duplicating the machine code across multiple banks,
or storing the machine code in a specific location which won&#8217;t be switched out.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="groups">10. Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Groups organize globals together based on how they are used in the program.
In NESFab, each global variable and <a href="#type_paa">pointer-addressible array</a> is associated with a group.</p>
</div>
<div class="paragraph">
<p>There are two types of groups: <code>vars</code> and <code>data</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kw_vars"><code>vars</code></a> is for variables (RAM).</p>
</li>
<li>
<p><a href="#kw_data"><code>data</code></a> is for read-only data (ROM).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, <code>data</code> has two variants: <code>data</code> and <code>omni data</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kw_data"><code>data</code></a> is for read-only data that exists at a single address in a single <a href="#banks">bank</a>.</p>
</li>
<li>
<p><a href="#kw_omni"><code>omni data</code></a> is for read-only data that exists at a single address, but is duplicated across multiple <a href="#banks">banks</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a guideline, <code>omni data</code> uses more ROM space, but has better performance than <code>data</code>.
Typically, it is recommended to use <code>data</code> for most everything, and only use <code>omni data</code> for small look-up tables that are frequently used.</p>
</div>
<div class="paragraph">
<p><strong>Why groups?</strong></p>
</div>
<div class="paragraph">
<p>To the programmer, the purpose of groups are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To organize code.</p>
</li>
<li>
<p>To specify the storage of a variable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To the compiler, the purpose of groups are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To enable the compiler to smartly allocate variables by reusing RAM addresses.</p>
</li>
<li>
<p>To facilitate <a href="#mappers">mappers</a> with multiple banks, enabling smarter linking.</p>
</li>
<li>
<p>To simplify pointer aliasing optimizations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_2">11. Comments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NESFab supports two kinds of <a href="https://en.wikipedia.org/wiki/Comment_(computer_programming)">comments</a>: single-line and multi-line.</p>
</div>
<div class="sect2">
<h3 id="_single_line_comments">11.1. Single-Line Comments</h3>
<div class="paragraph">
<p>Single-line comments begin with the character sequence <code>//</code>, and terminate at the end of the line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// This is a single-line comment.

ct U foo = 10 // You can put them after lines of code to document it.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_line_comments">11.2. Multi-Line Comments</h3>
<div class="paragraph">
<p>Multi-line comments begin with the character sequence <code>/*</code> on a new line, and terminate with the character sequence <code>*/</code>, followed by a line ending.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unlike other languages, multi-line comments cannot share lines with code.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>/*
   This is a multi-line
   comment!
*/

/* This is also a
   multi-line comment! */

ct U foo = 10 /* This won't compile.
Multi-line comments cannot share lines with code. */

/*
   This won't compile.
   Multi-line comments cannot share lines with code.
*/ ct U foo = 10</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="byte_blocks">12. Byte Blocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Byte blocks are a special syntax used to define inline assembly code and <a href="#paa_type">PAA</a> data.</p>
</div>
<div class="sect2">
<h3 id="byte_blocks_typed_data">12.1. Typed Data</h3>
<div class="paragraph">
<p>Data can be inserted into byte blocks using a syntax identical to <a href="#casts">casts</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Type(values...)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Type</code> is a type name.</p>
</li>
<li>
<p><code>values</code> are a comma-separated list of expressions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value is <a href="#casts">cast</a>, then inserted into the byte block with the following order:
- For numeric types, the bytes are inserted in little-endian order.
- For <a href="#type_struct">structures</a>, the first member is inserted first, then the second, and so on.
- For <a href="#type_TEA">TEAs</a>, the first element is inserted first, then the second, and so on.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /some_group
    [] some_data
        U(10)
        UU(2000)
        U[3](1,2,3)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="byte_blocks_untyped_data">12.2. Untyped Data</h3>
<div class="paragraph">
<p>The type name of <a href="#byte_blocks_typed_data">typed data</a> can be elided,
causing the type to inferred from the expression.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(values)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>values</code> is an expression.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value is inserted into the byte block following the rules of <a href="#byte_blocks_typed_data">typed data</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /some_group
    [] some_data
        (U(10) + U(20))
        (UU(300).x)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assembly_instructions">12.3. Assembly Instructions</h3>
<div class="paragraph">
<p>Assembly instructions can be inserted into byte blocks with a syntax similar to 6502 assemblers.</p>
</div>
<div class="paragraph">
<p>Syntaxes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>op           // Implied
op #num      // Immediate
op addr      // Direct (Zero page or absolute)
op addr      // Relative
op (addr)    // Indirect
op addr, x   // Direct, X
op addr, y   // Direct, Y
op (addr, y) // Indirect, X
op (addr), y // Indirect, Y</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>op</code> is one of the op codes listed below in all uppercase, or all lowercase letters.</p>
</li>
<li>
<p><code>num</code> is a value of type <a href="#type_integer"><code>U</code></a>.</p>
</li>
<li>
<p><code>addr</code> is a value of type <a href="#type_address"><code>AA</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Valid Op Codes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>adc
and
asl
bcc
bcs
beq
bit
bmi
bne
bpl
brk
bvc
bvs
clc
cld
cli
clv
cmp
cpx
cpy
dec
dex
dey
eor
inc
inx
iny
jmp
jsr
lda
ldx
ldy
lsr
nop
ora
pha
php
pla
plp
rol
ror
rti
rts
sbc
sec
sed
sei
sta
stx
sty
tax
tay
tsx
txa
txs
tya
lax
axs
anc
alr
arr
sax
skb
ign
dcp
isc
rla
rra
slo
sre</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /some_group
    [] some_data
        lda #30
        sta $2003
        ldy #0
        lda ($2000), y
        sta ($00, x)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_special_statements">12.4. Special Statements</h3>
<div class="paragraph">
<p>The following statements have special meaning inside of byte blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kw_label_asm"><code>label</code></a></p>
</li>
<li>
<p><a href="#kw_nmi_asm"><code>nmi</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the following statements have special meaning inside of <a href="#kw_asm"><code>asm fn</code></a> byte blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kw_fn_asm"><code>fn</code></a></p>
</li>
<li>
<p><a href="#kw_goto_asm"><code>goto</code></a></p>
</li>
<li>
<p><a href="#kw_goto_mode_asm"><code>goto mode</code></a></p>
</li>
<li>
<p><a href="#kw_switch_asm"><code>switch</code></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keywords">13. Keywords</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_if">13.1. <code>if</code></h3>
<div class="paragraph">
<p>The <code>if</code> <a href="#statement">statement</a> allows for conditional execution of <a href="#blocks">code blocks</a>.
It behaves like <code>if</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if expression
    code block</pre>
</div>
</div>
<div class="paragraph">
<p>The conditional expression of <code>if</code> will be converted to <code>Bool</code>.
If this evaluates to <code>true</code>, the body of the <code>if</code> statement will be executed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_else">13.2. <code>else</code></h3>
<div class="paragraph">
<p>The <code>else</code> <a href="#statement">statement</a> allows for control flow to branch between two <a href="#blocks">code blocks</a>.
It behaves like <code>else</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>This statement must be paired with a corresponding <code>if.</code></p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if expression
    code block
else
    code block</pre>
</div>
</div>
<div class="paragraph">
<p>If the corresponding <code>if</code> evaluates to <code>false</code>, the body of the <code>else</code> statement will be executed.</p>
</div>
<div class="paragraph">
<p>For visual appeal, other statements may follow the <code>else</code> keyword on the same line, including <code>if</code>, <code>for</code>, and <code>while</code>.
This looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if expression
    code block
else if expresssion
    code block
else
    code block</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_while">13.3. <code>while</code></h3>
<div class="paragraph">
<p>The <code>while</code> <a href="#statement">statement</a> allows for looping control flow.
It behaves like <code>while</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>while condition
    code block</pre>
</div>
</div>
<div class="paragraph">
<p><code>condition</code> is an expression converted to <code>Bool</code>. While this expression evaluates to <code>true</code>, the loop body will execute.
After the code in <code>code block</code> executes, control flow jumps back to the <code>condition</code> test.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_for">13.4. <code>for</code></h3>
<div class="paragraph">
<p>The <code>for</code> <a href="#statement">statement</a> allows for looping control flow, with more features than <a href="#kw_while"><code>while</code></a>.
It behaves like <code>for</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>for initialization ; condition ; iteration
    code block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialization</code> executes before the loop and can be an expression or a variable initialization.</p>
</li>
<li>
<p><code>condition</code> is an expression converted to <code>Bool</code>. While this expression evaluates to <code>true</code>, the loop body will execute.</p>
</li>
<li>
<p><code>iteration</code> is an expression to be run at the end of every iteration (following the code block).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any of these expressions may be empty. An empty <code>condition</code> is equivalent to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>After the code in <code>code block</code> executes, <code>iteration</code> executes, and then control flow jumps back to the <code>condition</code> test.</p>
</div>
<div class="paragraph">
<p>Like <code>while</code>, the keywords <a href="#kw_break"><code>break</code></a> and <a href="#kw_continue">[kw_continue]</a> may be used inside of a <code>for</code>.</p>
</div>
<div class="paragraph">
<p>For visual appeal, the expressions of <code>for</code> may be put on separate lines starting with the <code>;</code> character, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>for initialization
; condition
; iteration
    code block</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_do">13.5. <code>do</code></h3>
<div class="paragraph">
<p>The <code>do</code> keyword can be prefixed to either <a href="#kw_while"><code>while</code></a> or <a href="#kw_for"><code>for</code></a> to alter their behavior.
A loop with <code>do</code> skips the <code>condition</code> check of its first iteration.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>do while condition
    code block

do for initialization ; condition ; iteration
    code block</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Loops written with <code>do</code> often have better runtime performance than loops written without.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kw_break">13.6. <code>break</code></h3>
<div class="paragraph">
<p><code>break</code> ends the execution of the containing <a href="#kw_while"><code>while</code></a>, <a href="#kw_for"><code>for</code></a>, or <a href="#kw_switch"><code>switch</code></a> statement.
It behaves like <code>break</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>break</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>for U i = 0; i &lt; 10; i += 1
    if array[i] == 0
        break // Exits the loop</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to exit out of multiple nested statements, use <a href="#kw_goto"><code>goto</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_continue">13.7. <code>continue</code></h3>
<div class="paragraph">
<p><code>continue</code> is used inside <a href="#kw_while"><code>while</code></a> or <a href="#kw_for"><code>for</code></a> statements,
and causes control flow to jump to the end of the loop&#8217;s code block.
It behaves like <code>condition</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>continue</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>for U i = 0; i &lt; 10; i += 1
    if array[i] == 0
        continue // If this executes, the line below it won't.
    array[i] += i</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_switch">13.8. <code>switch</code></h3>
<div class="paragraph">
<p>The <code>switch</code> statement branches control flow based on an byte value.
<code>switch</code> is similar to <a href="#kw_if">[kw_if]</a>, but instead of having a choice between two code blocks,
<code>switch</code> allows multiple. It behaves like <code>switch</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>switch expression
    code block</pre>
</div>
</div>
<div class="paragraph">
<p><code>expression</code> must be of type <code>U</code> or <code>S</code>.</p>
</div>
<div class="paragraph">
<p><code>switch</code> is intended to be used with <a href="#kw_case"><code>case</code></a> and <a href="#kw_default"><code>default</code></a>.
Both of these label where control flow will jump.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>switch player_state
    case 0
        do_run()
        break

    case 1
        do_jump()
        break

    case 2
        do_kick()
        break

    default:
        do_nothing()
        break</pre>
</div>
</div>
<div class="sect3">
<h4 id="kw_switch_asm">13.8.1. <code>switch</code> statement (byte block)</h4>
<div class="paragraph">
<p>In byte blocks, the <code>switch</code> statement causes the mapper to bankswitch to a specified <a href="#banks">bank</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>switch regs</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>regs</code> specifies which registers are holding the bank to switch to. The accepted values are <code>x</code>, <code>y</code>, and <code>ax</code>,
where <code>ax</code> requires registers A and X to hold the same value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ldy &amp;my_bank1 // Load the bank in registers Y
switch y      // Switch to the bank in that register

lax &amp;my_bank2 // Load the bank in registers A and X
switch ax     // Switch to the bank in those registers</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_case">13.9. <code>case</code></h3>
<div class="paragraph">
<p><code>case</code> is used inside of <a href="#kw_switch"><code>switch</code></a> statements as a label.
Control flow will jump to the <code>case</code> from the <code>switch</code> if the switch&#8217;s expression matches the <code>case</code> value.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>case constant expression
    code block</pre>
</div>
</div>
<div class="paragraph">
<p><code>constant expression</code> is an expression which can be computed at compile-time.</p>
</div>
<div class="paragraph">
<p>The <code>code block</code> of <code>case</code> exists only to provide a scope.
There is no other difference between the syntax above, and this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>case constant expression
code block</pre>
</div>
</div>
<div class="paragraph">
<p>As stated, <code>case</code> is a label.
It can appear inside other statements such as <a href="#kw_for"><code>for</code></a> or <a href="#kw_if">[kw_if]</a>.</p>
</div>
<div class="paragraph">
<p>See more examples in <a href="#kw_switch"><code>switch</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_default">13.10. <code>default</code></h3>
<div class="paragraph">
<p><code>default</code> is used inside of <a href="#kw_switch"><code>switch</code></a> statements as a label.
Control flow will jump to the <code>default</code> from the <code>switch</code> if the switch&#8217;s expression matches no enclosed <a href="#hw_case">[hw_case]</a> statemen.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>default
    code block</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>code block</code> of <code>default</code> exists only to provide a scope.
There is no other difference between the syntax above, and this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>default
code block</pre>
</div>
</div>
<div class="paragraph">
<p>As stated, <code>default</code> is a label.
It can appear inside other statements such as <a href="#kw_for"><code>for</code></a> or <a href="#kw_if">[kw_if]</a>.</p>
</div>
<div class="paragraph">
<p>See more examples in <a href="#kw_switch"><code>switch</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_goto">13.11. <code>goto</code></h3>
<div class="paragraph">
<p>The keyword <code>goto</code> has use in two different types of statements: <code>goto</code> and <code>goto mode</code>.</p>
</div>
<div class="sect3">
<h4 id="kw_goto_statement">13.11.1. <code>goto</code> statement</h4>
<div class="paragraph">
<p>The <code>goto</code> statement causes control flow to jump to a corresponding <a href="#kw_label"><code>label</code></a> in the same function.
It behaves like <code>goto</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>goto identifier</pre>
</div>
</div>
<div class="paragraph">
<p><code>identifier</code> refers to the name of a label in the current function.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    U i = 0
    label loop
    i += 1
    if i &lt; 10
        goto loop</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_goto_mode_statement">13.11.2. <code>goto mode</code> statement</h4>
<div class="paragraph">
<p>The <code>goto mode</code> statement causes control flow to jump to a <a href="#kw_mode"><code>mode</code></a>,
discarding the current call stack and starting anew.
In the process, global variables will be reset to their initial value,
unless they are explicitly preserved using <a href="#mod_preserves"><code>preserves</code></a> in the <code>goto mode</code> statement.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>goto mode identifier(arguments)
: preserves /groups</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> if the name of a <a href="#kw_mode"><code>mode</code></a> function.</p>
</li>
<li>
<p><code>arguments</code> is a comma-separated list of expressions to be passed to the <code>mode</code> function. The list may be blank.</p>
</li>
<li>
<p><code>groups</code> are a list of <a href="#kw_vars"><code>vars</code></a> groups, denoting which variables should not be reset. The list may be blank.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that <code>preserves</code> is a required <a href="#modifier">modifier</a> of this statement.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /my_vars
    U some_var = 10

mode foo()
    goto mode bar(some_var + 1)
    : preserves

mode bar(U some_argument)
    my_vars = some_argument

    goto mode foo()
    : preserves /my_vars</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_goto_asm">13.11.3. <code>goto</code> (assembly byte block)</h4>
<div class="paragraph">
<p>In assembly functions, the <code>goto</code> statement causes control to switch execution to another function,
clobbering all registers in the process.
It behaves similar to the <a href="#kw_fn_asm"><code>fn</code> assembly statement</a>, but does not return.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>goto fn_identifier</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fn_identifier</code> is the name of a function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the function accepts arguments, those arguments must be set prior to the <code>goto</code> statement.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U x)
    // ...

asm fn bar()
: employs
    default
        lda #5
        sta &amp;foo.x      // Set the argument
        goto foo</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_goto_mode_asm">13.11.4. <code>goto mode</code> (assembly byte block)</h4>
<div class="paragraph">
<p>In assembly functions, the <code>goto mode</code> statement causes control to switch execution to a mode,
clobbering all registers, discarding the current call stack, and starting anew.
In the process, global variables will be reset to their initial value,
unless they are explicitly preserved using <a href="#mod_preserves"><code>preserves</code></a> in the <code>goto mode</code> statement.
It behaves similar to the <a href="#kw_goto_mode"><code>fn</code> assembly statement</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>goto mode mode_identifier
: preserves /groups</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mode_identifier</code> if the name of a <a href="#kw_mode"><code>mode</code></a> function.</p>
</li>
<li>
<p><code>groups</code> are a list of <a href="#kw_vars"><code>vars</code></a> groups, denoting which variables should not be reset. The list may be blank.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that <code>preserves</code> is a required <a href="#modifier">modifier</a> of this statement.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /my_vars
    U some_var = 10

mode foo()
    // ...

asm fn bar()
    goto mode foo
    : preserves /my_vars</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_label">13.12. <code>label</code></h3>
<div class="paragraph">
<p>The <code>label</code> statement introduces a point which a <a href="#kw_goto_statement"><code>goto</code> statement</a> can jump to .
It has no effect otherwise.
It behaves like labels in most programming languages, albeit with a slightly different syntax.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>label identifier
    code_block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the unique name of the label.</p>
</li>
<li>
<p><code>code_block</code> is an optional indented code block.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>code_block</code> of <code>label</code> exists only to provide a scope.
There is no other difference between the syntax above, and this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>label identifier
code_block</pre>
</div>
</div>
<div class="sect3">
<h4 id="kw_label_asm">13.12.1. <code>label</code> statement (byte block)</h4>
<div class="paragraph">
<p>Labels give names to specific addresses inside of byte blocks.
They behave similarly to <a href="#kw_ct"><code>ct</code></a> definitions, defining values of type <a href="#type_address"><code>AA</code> and <code>AAA</code></a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>label identifier
    byte_block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the unique name of the label.</p>
</li>
<li>
<p><code>byte_block</code> is an optional indented byte block to be inserted into the containing byte block.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>byte_block</code> of <code>label</code> exists only to provide a scope.
There is no other difference between the syntax above, and this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>label identifier
byte_block</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /some_group
    [] some_data
        label foo
            jmp foo</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_return">13.13. <code>return</code></h3>
<div class="sect3">
<h4 id="kw_return_statement">13.13.1. <code>return</code> statement</h4>
<div class="paragraph">
<p>The <code>return</code> statement ends the execution of the current function,
using its argument as the function&#8217;s return value.
It behaves like <code>return</code> in most programming languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>return expression</pre>
</div>
</div>
<div class="paragraph">
<p>Syntax for functions lacking a return value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>return</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_return_expression">13.13.2. <code>return</code> expression</h4>
<div class="paragraph">
<p>A <code>return</code> expression <strong>does not cause functions to return</strong>.
Instead, it provides a handle to the current function&#8217;s return value.
Although the value itself cannot be used, the address of can be taken using <a href="#unary_ops">unary operator</a> <code>&amp;</code>,</p>
</div>
<div class="paragraph">
<p>This functionality exists because of &lt;&lt;`asm`, inline assembly&gt;&gt;.
Most often, it is used to allow inline assembly functions to return values
by storing into the address.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>AA return_addr = &amp;return</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_fence">13.14. <code>fence</code></h3>
<div class="paragraph">
<p>The <code>fence</code> statement is used for both writing concurrent code, and for interacting with hardware.
It imposes constraints on how global variables are loaded and stored,
preventing the compiler from re-ordering them.</p>
</div>
<div class="paragraph">
<p>More precisely:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every global variable the function is tracking will be stored before the <code>fence</code> executes.</p>
</li>
<li>
<p>Every global variable the function is tracking will be loaded after the <code>fence</code> executes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Why is <code>fence</code> a thing?</strong></p>
</div>
<div class="paragraph">
<p>The NESFab compiler performs optimizations which moves loads and stores around.
This is normally fine, but issues arise due to interrupts.</p>
</div>
<div class="paragraph">
<p>To illustrate, take a look at the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo = 10
bar = 20</pre>
</div>
</div>
<div class="paragraph">
<p>The compile is free to re-order these global variable assignments, storing into <code>bar</code> before <code>foo</code>.
However, imagine if an interrupt were to occur between these stores.
The interrupt would see that <code>bar</code> equals <code>20</code>, but not <code>foo</code> equals <code>10</code>,
as the store to <code>foo</code> hasn&#8217;t happened yet.</p>
</div>
<div class="paragraph">
<p>To prevent this re-ordering, a <code>fence</code> statement can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo = 10
fence
bar = 20</pre>
</div>
</div>
<div class="paragraph">
<p>Now if the interurpt sees that <code>bar</code> equals <code>20</code>, <code>foo</code> must equal <code>10</code>.</p>
</div>
<div class="paragraph">
<p><strong>Another purpose for <code>fence</code>:</strong></p>
</div>
<div class="paragraph">
<p><code>fence</code> is also used when interacting with the hardware directly.
When reading or writing a global variable via its hardware address,
two <code>fence</code> statements are required with the hardware access between them.
These <code>fence</code> statements instruct the compiler to store the global before the hardware access,
and load the value after it.</p>
</div>
<div class="paragraph">
<p>A common example arises when doing <a href="https://www.nesdev.org/wiki/PPU_registers#OAMDMA">OAM DMA</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fence
{OAMDMA}((&amp;oam).b)
fence</pre>
</div>
</div>
<div class="paragraph">
<p>Without these <code>fence</code> instructions, the compiler would not recognize that global variables are being read.
and so the resulting read may have incorrect results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>fence</code> does not instruct the compiler <strong>which</strong> globals to track.
To do that, the modifier <a href="#hw_employs">[hw_employs]</a> is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kw_true">13.15. <code>true</code></h3>
<div class="paragraph">
<p><code>true</code> is an expression of type <code>Bool</code>, and has a compile-time constant value.
When converted to an integer type, it will have the value <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_false">13.16. <code>false</code></h3>
<div class="paragraph">
<p><code>false</code> is an expression of type <code>Bool</code>, and has a compile-time constant value.
When converted to an integer type, it will have the value <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>false</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_ready">13.17. <code>ready</code></h3>
<div class="paragraph">
<p><code>ready</code> is an expression of type <code>Bool</code> which returns <code>true</code> if both an <a href="#nmi">NMI</a> is active and the program was <a href="#kw_nmi">waiting on one</a>,
or <code>false</code> otherwise.
It is intended to be used as a synchronization primitive (<a href="https://en.wikipedia.org/wiki/Lock_(computer_science)">mutex</a>)
to avoid <a href="https://en.wikipedia.org/wiki/Race_condition">race conditions</a> inside of NMI handlers.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ready</pre>
</div>
</div>
<div class="paragraph">
<p>In general, if <code>ready</code> is <code>true</code>, all global variables are in a stable, concurrent-safe state.
Likewise, if <code>ready</code> is <code>false</code>, either no NMI is happening, or the program is lagging one or more frames.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nmi foo()
    if ready
        upload_data()
        poll_controller()
    play_music()</pre>
</div>
</div>
<div class="paragraph">
<p>The address of <code>ready</code> can be taken using <a href="#unary_ops">unary operator</a> <code>&amp;</code>,
but the pointed-to value must never be modified by the program.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is more than one way to achieve concurrent safety. See <a href="#kw_fence"><code>fence</code></a>, for example.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kw_state">13.18. <code>state</code></h3>
<div class="paragraph">
<p>Some <a href="#mappers">mappers</a> have states which can be switched for various effects.
For example, <code>ANROM</code> uses a bit to track the cartridge&#8217;s mirroring, and lets the programmer switch it on the fly.
<code>state</code> expressions read or write these <a href="#mappers">mappers'</a> states.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The NESFab runtime duplicates the mapper&#8217;s state to a fixed location in RAM.
Reading the state will return this copy instead of polling the hardware.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_state_read">13.18.1. <code>state</code> read</h4>
<div class="paragraph">
<p><code>state</code> is an expression of type <code>U</code> which returns the mapper&#8217;s last-set state.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>state()</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = state()</pre>
</div>
</div>
<div class="paragraph">
<p>The address of <code>state</code> can be taken using <a href="#unary_ops">unary operator</a> <code>&amp;</code>.
This address refers to the copy in RAM; modifying it does not notify the hardware.</p>
</div>
</div>
<div class="sect3">
<h4 id="_state_write">13.18.2. <code>state</code> write</h4>
<div class="paragraph">
<p><code>state</code> is an expression of type <code>Void</code> which sets the mapper&#8217;s state.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>state(expr)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expr</code> is an expression of type <code>U</code>. The state will be assigned this value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>state(5) // The state will have a value of 5</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Mappers often reserve a few bits of their state for their bank.
You should always leave these bits set to <code>0</code>, as otherwise the program may crash.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_system">13.19. <code>system</code></h3>
<div class="paragraph">
<p><code>system</code> is an expression of type <code>U</code> which returns the <a href="#opt_system">current NES system</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>system</pre>
</div>
</div>
<div class="paragraph">
<p>The possible return values are listed below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enumeration</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_ntsc"><code>SYSTEM_NTSC</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_pal"><code>SYSTEM_PAL</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_dendy"><code>SYSTEM_DENDY</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_system_unknown"><code>SYSTEM_UNKNOWN</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo()
    if system == SYSTEM_NTSC
        speed = 1.0
    else
        speed = 1.2</pre>
</div>
</div>
<div class="paragraph">
<p>When the <a href="#opt_system"><code>system</code> option</a> is set to <code>detect</code>, the value will be determined at program startup.
Additionally, the address of <code>system</code> can be taken using <a href="#unary_ops">unary operator</a> <code>&amp;</code>,
but the pointed-to value must never be modified by the program.</p>
</div>
<div class="paragraph">
<p>When the <a href="#opt_system"><code>system</code> option</a> is not set to <code>detect</code>, the expression is a compile-time constant
and its address cannot be taken.</p>
</div>
<div class="sect3">
<h4 id="kw_system_ntsc">13.19.1. <code>SYSTEM_NTSC</code></h4>
<div class="paragraph">
<p><code>SYSTEM_NTSC</code> is an expression of type <code>Int</code>, and has a compile-time constant value of <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SYSTEM_NTSC</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_system_pal">13.19.2. <code>SYSTEM_PAL</code></h4>
<div class="paragraph">
<p><code>SYSTEM_PAL</code> is an expression of type <code>Int</code>, and has a compile-time constant value of <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SYSTEM_PAL</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_system_dendy">13.19.3. <code>SYSTEM_DENDY</code></h4>
<div class="paragraph">
<p><code>SYSTEM_DENDY</code> is an expression of type <code>Int</code>, and has a compile-time constant value of <code>2</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SYSTEM_DENDY</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_system_unknown">13.19.4. <code>SYSTEM_UNKNOWN</code></h4>
<div class="paragraph">
<p><code>SYSTEM_UNKNOWN</code> is an expression of type <code>Int</code>, and has a compile-time constant value of <code>3</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SYSTEM_UNKNOWN</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_ppu_regs">13.20. PPU Registers</h3>
<div class="paragraph">
<p>The following <a href="https://www.nesdev.org/wiki/PPU_registers">PPU registers</a> have keywords.
All of these are expressions of type <code>AA</code> with compile-time constant values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enumeration</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppuctrl"><code>PPUCTRL</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppumask"><code>PPUMASK</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppustatus"><code>PPUSTATUS</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2002</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_oamaddr"><code>OAMADDR</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2003</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_oamdata"><code>OAMDATA</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2004</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppuscroll"><code>PPUSCROLL</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2005</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppuaddr"><code>PPUADDR</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2006</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_ppudata"><code>PPUDATA</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$2007</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#kw_oamdma"><code>OAMDMA</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$4014</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="kw_ppuctrl">13.20.1. <code>PPUCTRL</code></h4>
<div class="paragraph">
<p><code>PPUCTRL</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2000</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUCTRL</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Controller_($2000)_%3E_write">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_ppumask">13.20.2. <code>PPUMASK</code></h4>
<div class="paragraph">
<p><code>PPUMASK</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2001</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUMASK</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Mask_($2001)_%3E_write">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_ppustatus">13.20.3. <code>PPUSTATUS</code></h4>
<div class="paragraph">
<p><code>PPUSTATUS</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2002</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUSTATUS</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Status_($2002)_%3C_read">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_oamaddr">13.20.4. <code>OAMADDR</code></h4>
<div class="paragraph">
<p><code>OAMADDR</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2003</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OAMADDR</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#OAM_address_($2003)_%3E_write">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_oamdata">13.20.5. <code>OAMDATA</code></h4>
<div class="paragraph">
<p><code>OAMDATA</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2004</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OAMDATA</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#OAM_data_($2004)_%3C%3E_read/write">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_ppuscroll">13.20.6. <code>PPUSCROLL</code></h4>
<div class="paragraph">
<p><code>PPUSCROLL</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2005</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUSCROLL</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Scroll_($2005)_%3E%3E_write_x2">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_ppuaddr">13.20.7. <code>PPUADDR</code></h4>
<div class="paragraph">
<p><code>PPUADDR</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2006</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUADDR</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Address_($2006)_%3E%3E_write_x2">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_ppudata">13.20.8. <code>PPUDATA</code></h4>
<div class="paragraph">
<p><code>PPUDATA</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$2007</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PPUDATA</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#Data_($2007)_%3C%3E_read/write">Wiki page for this PPU register</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kw_oamdma">13.20.9. <code>OAMDMA</code></h4>
<div class="paragraph">
<p><code>OAMDMA</code> is an expression of type <code>AA</code>, and has a compile-time constant value of <code>$4014</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OAMDMA</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.nesdev.org/wiki/PPU_registers#OAM_DMA_($4014)_%3E_write">Wiki page for this PPU register</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_fn">13.21. <code>fn</code></h3>
<div class="paragraph">
<p>The <code>fn</code> keyword declares a
<a href="https://en.wikipedia.org/wiki/Function_(computer_programming)">function</a>
at global scope.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn identifier(parameters) ReturnType
    code block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the name of the function.</p>
</li>
<li>
<p><code>parameters</code> is a comma-separated list of variables with the syntax <code>Type name</code>.</p>
</li>
<li>
<p><code>ReturnType</code> is a type name, but is optional. Leaving <code>ReturnType</code> blank is the same as specifying it as <code>Void</code>.</p>
</li>
<li>
<p><code>code block</code> is the block of code which implements the function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Functions can only be declared at global-scope.
Unlike other programming languages, functions in NESFab cannot be nested or recursive.</p>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_employs"><code>employs</code></a>.</p>
</li>
<li>
<p><a href="#mod_data"><code>data</code></a>.</p>
</li>
<li>
<p><a href="#mod_vars"><code>vars</code></a>.</p>
</li>
<li>
<p><a href="#mod_flags"><code>+zero_page</code>, <code>-zero_page</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+inline</code>, <code>-inline</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+graphviz</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+info</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U p1, U p2) U
    return p1 + p2</pre>
</div>
</div>
<div class="sect3">
<h4 id="kw_fn_asm">13.21.1. <code>fn</code> statement (assembly byte block)</h4>
<div class="paragraph">
<p>In assembly functions, the <code>fn</code> statement calls a NESFab function,
clobbering all registers in the process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unlike the <code>JSR</code> instruction, the <code>fn</code> statement correctly handles the NESFab calling convention and runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn fn_identifier</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fn_identifier</code> is the name of a function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the function accepts arguments, those arguments must be set prior to the <code>fn</code> statement.
If the function returns a value, it can be retrieved via <a href="#kw_return_expression"><code>return</code></a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U x) U
    return x + x

asm fn bar()
: employs
    default
        lda #5
        sta &amp;foo.x       // Set the argument
        fn foo           // Call the function
        lda #&amp;foo.return // Read the return value
        sta PPUDATA
        rts</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_ct">13.22. <code>ct</code></h3>
<div class="paragraph">
<p><code>ct</code> is short for <em>compile-time</em>.
The keyword can be prefixed onto value and function declarations to <strong>insist</strong> that their computations occur at compile-time.</p>
</div>
<div class="sect3">
<h4 id="_ct_fn">13.22.1. <code>ct fn</code></h4>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct fn identifier(parameters) ReturnType</pre>
</div>
</div>
<div class="paragraph">
<p><code>ct fn</code> has the same syntax as <a href="#kw_fn"><code>fn</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ct_value">13.22.2. <code>ct</code> value</h4>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct TypeName identifier = value</pre>
</div>
</div>
<div class="paragraph">
<p><code>ct</code> values are declared with the syntax of regular variables, but must be defined a value.</p>
</div>
<div class="paragraph">
<p>They can be declared at global scope, or inside functions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_mode">13.23. <code>mode</code></h3>
<div class="paragraph">
<p>The <code>mode</code> keyword declares a mode function at global scope.
Modes are similar to <a href="#kw_fn">regular functions</a>, but they do not return.
Instead, the only way to leave a mode function is via a `<a href="#kw_goto_mode_statement"><code>goto mode</code> statement</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mode identifier(parameters)
    code block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the name of the mode function.</p>
</li>
<li>
<p><code>parameters</code> is a comma-separated list of variables with the syntax <code>Type name</code>.</p>
</li>
<li>
<p><code>code block</code> is the block of code which implements the mode function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every program is required to have a mode named <code>main</code> defined, which takes no parameters.
When the program starts, execution will begin at <code>main</code>.
This behavior is similar to <code>main</code> functions found in other programming languages.</p>
</div>
<div class="paragraph">
<p>Modes can be assigned a corresponding <a href="#kw_nmi_decl">nmi</a> function, using a <a href="#modifiers">modifier</a>.
While the mode function is executing, NMIs will be handled using the supplied <code>nmi</code> function.</p>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_nmi">[mod_nmi]</a>.</p>
</li>
<li>
<p><a href="#mod_employs"><code>employs</code></a>.</p>
</li>
<li>
<p><a href="#mod_data"><code>data</code></a>.</p>
</li>
<li>
<p><a href="#mod_vars"><code>vars</code></a>.</p>
</li>
<li>
<p><a href="#mod_flags"><code>+zero_page</code>, <code>-zero_page</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+graphviz</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+info</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mode main()
: nmi my_nmi
    while true
        x = x + 1</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Why do modes exist?</strong></p>
</div>
<div class="paragraph">
<p>There are two reasons.</p>
</div>
<div class="paragraph">
<p>First, it is convenient to be able to change what the program is doing deep inside a function call.
For example, in a video game it can be useful to define one <code>mode</code> for the main menu,
and another one for the actual gameplay.
To switch between the two, a <code>goto mode</code> statement can be used anywhere in the program,
which is nicer than having to use variables and switch-cases.</p>
</div>
<div class="paragraph">
<p>But more importantly, modes allow the compiler to smartly allocate memory,
enabling variables used in different modes to share RAM addresses.
This happens transparently from the programmer; no <a href="https://en.wikipedia.org/wiki/Tagged_union">sum types</a> needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_nmi">13.24. <code>nmi</code></h3>
<div class="paragraph">
<p>The keyword <code>nmi</code> can be used as a statement, or as a declaration.</p>
</div>
<div class="sect3">
<h4 id="kw_nmi_statement">13.24.1. <code>nmi</code> statement</h4>
<div class="paragraph">
<p>The <code>nmi</code> statement blocks execution until an <a href="#kw_nmi_function"><code>nmi</code> function</a> occurs.
Until the <code>nmi</code> statement returns, <a href="#kw_ready"><code>ready</code></a> will evaluate to <a href="#kw_true"><code>true</code></a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nmi</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_nmi_asm">13.24.2. <code>nmi</code> statement (byte block)</h4>
<div class="paragraph">
<p>In byte blocks, the <code>nmi</code> statement blocks execution until an <a href="#kw_nmi_function"><code>nmi</code> function</a> occurs,
clobbering all registers in the process.
Until the <code>nmi</code> statement returns, <a href="#kw_ready"><code>ready</code></a> will evaluate to <a href="#kw_true"><code>true</code></a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nmi</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kw_nmi_function">13.24.3. <code>nmi</code> function</h4>
<div class="paragraph">
<p>The <code>nmi</code> keyword declares an <a href="https://www.nesdev.org/wiki/NMI">NMI</a> interrupt function at global scope.
NMI interrupts are similar to <a href="#kw_fn">regular functions</a>, but they have no parameters, cannot return, and cannot be called.
Instead, they execute once per frame at the start of <a href="https://en.wikipedia.org/wiki/Vertical_blanking_interval">VBLANK</a>,
so long as bit 7 of <a href="https://www.nesdev.org/wiki/PPU_registers#PPUCTRL">PPUCTRL</a> is set.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nmi identifier()
    code block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the name of the mode function.</p>
</li>
<li>
<p><code>code block</code> is the block of code which implements the mode function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_employs"><code>employs</code></a>.</p>
</li>
<li>
<p><a href="#mod_data"><code>data</code></a>.</p>
</li>
<li>
<p><a href="#mod_vars"><code>vars</code></a>.</p>
</li>
<li>
<p><a href="#mod_flags"><code>+zero_page</code>, <code>-zero_page</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+graphviz</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+info</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Why do NMI interrupt functions exist?</strong></p>
</div>
<div class="paragraph">
<p>NMI interrupts provide a way for code to detect the vertical blanking interval (VBLANK).
This is important, as most modifications to the <a href="https://www.nesdev.org/wiki/PPU">PPU&#8217;s</a> state
require that rendering be turned off, and VBLANK is one such time.</p>
</div>
<div class="paragraph">
<p>Since the NMI interrupt occurs once per frame, it&#8217;s also convenient to use it as a timer.
Typically, game updates are run in sync with the NMI,
as otherwise the game would speed up or slow down based on how much computation is happening.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_asm">13.25. <code>asm</code></h3>
<div class="paragraph">
<p>The <code>asm</code> keyword declares an function at global scope using <a href="#byte_blocks">byte block</a> inline assembly syntax.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>asm fn identifier(parameters) ReturnType
: employs /groups
    vars
        local vars
    byte block</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the name of the function.</p>
</li>
<li>
<p><code>parameters</code> is a comma-separated list of variables with the syntax <code>Type name</code>.</p>
</li>
<li>
<p><code>ReturnType</code> is a type name, but is optional. Leaving <code>ReturnType</code> blank is the same as specifying it as <code>Void</code>.</p>
</li>
<li>
<p><code>/groups</code> is an optional list of groups that the function uses. See <a href="#kw_employs"><code>employs</code></a>.</p>
</li>
<li>
<p><code>local vars</code> is a line-separated list of variables with the syntax <code>Type name</code>.</p>
</li>
<li>
<p><code>byte block</code> is the <a href="#byte_blocks">byte block</a> of code which implements the function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A special <code>default</code> label is required in each <code>asm</code> function,
and specifies the entry point to the function.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>asm fn waste_time()
: employs
    vars
        U counter
    default
        lda #0
    label loop
        sta &amp;counter
        inc &amp;countner
        bne loop
        rts</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_employs"><code>employs</code></a>.</p>
</li>
<li>
<p><a href="#mod_data"><code>data</code></a>.</p>
</li>
<li>
<p><a href="#mod_vars"><code>vars</code></a>.</p>
</li>
<li>
<p><a href="#mod_flags"><code>+zero_page</code>, <code>-zero_page</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+graphviz</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+info</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The labels of an <code>asm</code> function are visible using the <a href="#member_access"><code>.</code> operator</a>.
Although the address cannot be taken of these labels, it is possible to call them like functions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>waste_time.loop()</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_struct">13.26. <code>struct</code></h3>
<div class="paragraph">
<p>The <code>struct</code> keyword is used to define new types (<a href="https://en.wikipedia.org/wiki/Record_(computer_science)">records</a>) at global scope.
It behaves similarly to the <code>struct</code> keyword in other languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct NewTypeName
    fields</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NewTypeName</code> is the name of the <code>struct</code>.</p>
</li>
<li>
<p><code>fields</code> is a newline-separated list of fields, with the syntax <code>TypeName field_name</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct Circle
    S center_x
    S center_y
    UF radius</pre>
</div>
</div>
<div class="paragraph">
<p><code>struct</code> types may contain arrays and other <code>struct</code> types,
so long as multi-dimensional arrays are not created.</p>
</div>
<div class="paragraph">
<p>Like all values in <code>NESFab</code>, <code>struct</code> types are passed by value.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_vars">13.27. <code>vars</code></h3>
<div class="paragraph">
<p>The <code>vars</code> keyword declares a block of global variables, and potentially their <a href="#groups">group</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /group_name
    variables</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_name</code> is the optional name of the group that the variables will be part of.</p>
</li>
<li>
<p><code>variables</code> are global variables definitions with the syntax <code>TypeName identifier</code> or <code>TypeName identifier = value</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assigning to a global variable in a <code>vars</code> block sets its initial value.
The variable will reset to this value at the start of the program,
but also whenever a <a href="#kw_goto_mode_statement"><code>goto mode</code> statement</a> occurs and the variable&#8217;s group is not <a href="#mod_preserves">preserved</a></p>
</div>
<div class="paragraph">
<p>The same group can be declared multiple times,
with each declaration defining additional global variables.
The group will be defined as the union of these declarations.</p>
</div>
<div class="paragraph">
<p><strong>Varibale modifiers:</strong></p>
</div>
<div class="paragraph">
<p>The following modifiers are per-variable, not per-group.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_flags"><code>+align</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+zero_page</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /my_group
    U score = 0 // Set an initial value for 'score'
    UU player_x
    UU player_y

vars /my_group
    U speed</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_data">13.28. <code>data</code></h3>
<div class="paragraph">
<p>The <code>data</code> keyword declares a <a href="#groups">group</a> and the pointer-addressable global constants inside of it.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /group_name
    constants</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group_name</code> is the mandatory name of the group that the constants will be part of.</p>
</li>
<li>
<p><code>constants</code> are global constant definitions with the syntax <code>[optional_size] identifier</code>, followed by a <a href="#byte_blocks">byte block</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same group can be declared multiple times,
with each declaration defining additional global variables.
The group will be defined as the union of these declarations.</p>
</div>
<div class="paragraph">
<p><strong>Constant modifiers:</strong></p>
</div>
<div class="paragraph">
<p>The following modifiers are per-constant, not per-group.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_flags"><code>+align</code></a></p>
</li>
<li>
<p><a href="#mod_flags"><code>+dpcm</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>data /my_group
    [4] player_speeds
        U(1)
        U(4)
        U(8)
        U(20)

    [4] player_attacks
        U(10)
        U(20)
        U(30)
        U(40)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_omni">13.29. <code>omni</code></h3>
<div class="paragraph">
<p>The <code>omni</code> keyword can be prefixed to <a href="#kw_data"><code>data</code></a> to alter its behavior.
Groups declared using <code>omni</code> will have their data duplicated across every bank of the ROM.
Pointers to data inside this group will not include a bank field (e.g. type <code>CC</code> instead of <code>CCC</code>).</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>omni data /group_name
    constants</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group_name</code> is the optional name of the group that the constants will be part of.</p>
</li>
<li>
<p><code>constants</code> are global constant definitions with the syntax <code>[optional_size] identifier</code>, followed by a <a href="#byte_blocks">byte block</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Why use <code>omni</code>?</strong></p>
</div>
<div class="paragraph">
<p>Data inside an <code>omni</code> block can be accessed slightly quicker, at the expense of ROM size.
Additionally, pointers to <code>omni</code> data take up only two bytes, as opposed to three.</p>
</div>
<div class="paragraph">
<p>When using a <a href="#mappers">mapper</a> without PRG banks (such as NROM), it is strictly better to use <code>omni data</code> instead of <code>data</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_charmap">13.30. <code>charmap</code></h3>
<div class="paragraph">
<p>The <code>charmap</code> keyword defines character maps,
which are sets of characters with a mapping from each character to byte values.
It is used to specify text encoding, like
<a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a>,
<a href="https://en.wikipedia.org/wiki/EBCDIC">EBCDIC</a>,
or <a href="https://en.wikipedia.org/wiki/MIK_(character_set)">MIK</a>.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap identifier("string", 's')</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identifier</code> is the name of the charmap. This is optional. When left out, the default <code>charmap</code> is defined.</p>
</li>
<li>
<p><code>"string"</code> is a string literal, defining the characters of the charmap.
The first character in the string will map to a value of zero,
with other characters mapping to one higher than the character preceding them.</p>
</li>
<li>
<p><code>'s'</code> is an optional charcter literal, defining the sentinel. When left out, no sentinel is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_stows"><code>stows</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap foo(" ,.!?ABCDEFGHIJKLMNOPQRSTUVWXYZ\0", '\0')

// Defines the mapping:
// ' ' = 0
// ',' = 1
// '.' = 2
// '!' = 3
// '?' = 4
// 'A' = 5
// 'B' = 6
// 'C' = 7
// ... and so on
// with the sentinel being: '\0'</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap bar("abcd")
: stows /strings

// Defines the default charmap mapping:
// 'a' = 0
// 'b' = 1
// 'c' = 2
// 'd' = 3
// with no sentinel,
// and stowing its literals in group /strings.</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Shared Characters</strong></p>
</div>
<div class="paragraph">
<p>The escape sequence <code>\/</code> has a special meaning inside of <code>charmap</code> definitions.
A charcter preceding <code>\/</code> will map to the same value as the character following it.</p>
</div>
<div class="paragraph">
<p>Commonly, <code>\/</code> is used when multiple characters can use the same glyph,
such as <code>0</code> and <code>O</code>, or <code>1</code> and <code>I</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap foo("_0\/O1\/I\/|X", '\0')

// Defines the mapping:
// '_' = 0
// '0' = 1
// 'O' = 1
// '1' = 2
// '|' = 2
// 'I' = 2
// 'X' = 3</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Sizes and Members</strong></p>
</div>
<div class="paragraph">
<p>The number of unique values in a <code>charmap</code> can be accessed using the <code>size</code> member,
which is a compile-time constant value of type <code>Int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap foo("abc")

// The member 'size' is defined as:
// foo.size = 3

// Example use:
ct U last_foo_char = foo.size - 1</pre>
</div>
</div>
<div class="paragraph">
<p>To access the members of the default <code>charmap</code>, the expression <code>charmap</code> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Define the default charmap:
charmap("xyz")

// Access the default charmap using 'charmap':
ct U last_default_char = charmap.size - 1</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Sentinels</strong></p>
</div>
<div class="paragraph">
<p>For <code>charmaps</code> that define a sentinel character, two things occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String literals using the <code>charmap</code> have the sentinel character appended onto the end.</p>
</li>
<li>
<p>The member <code>sentinel</code> of type <code>U</code> is defined for <code>charmap</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The intention behind sentinel characters is to mark the end of strings.
This can be used to mimic the behavior of the C programming language&#8217;s <a href="https://en.wikipedia.org/wiki/Null-terminated_string">null-terminated strings</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap foo("abc", 'b')

// String literals have 'b' tacked on:
// "string"foo[6] = 'b'
// len("string"foo) = 7

// The member 'sentinel' is defined for 'foo':
// foo.sentinel = 1

charmap c_string("\0abc", '\0')

// This literal is terminated by the value 0:
// "hello world"c_string

// The member 'sentinel' is defined for 'c_string':
// c_string.sentinel = 0</pre>
</div>
</div>
<div class="paragraph">
<p>Note that sentinels must have a mapping defined in the <code>charmap</code>.
Doing so otherwise is an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap bad_charmap("abc", 'z') // Error! 'z' is not in the charmap!</pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>stows</code> Group</strong></p>
</div>
<div class="paragraph">
<p><code>charmap</code> accepts a single group in its <code>stows</code> <a href="#modifiers">modifiers</a>.
If defined, string literals using the <code>charmap</code> become valid operands to <a href="#get_ptr">operator <code>@</code></a> and <a href="#get_hw_addr">operator <code>&amp;</code></a>.
When using these operators, the contents of the string literal will exist in the group as data.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>charmap foo("ABCD")
: stows /strings

// Can now reference strings using literals:
ct CCC/strings some_ptr = @"AAA"

// This is akin to defining the string inside a 'data' block first:
data /strings
    [] some_string
        ("AAA")
// ... and then referencing it:
ct CCC/strings another_ptr = @some_string</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_chrrom">13.31. <code>chrrom</code></h3>
<div class="paragraph">
<p>The <code>chrrom</code> keyword is only used for <a href="#mappers">mappers</a> which use CHR ROM (as opposed to CHR RAM).
It specifies the data of the CHR ROM using a <a href="#byte_blocks">byte block</a> syntax.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chrrom
    byte block</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chrrom
    file(chr, "sprites.png")
    file(chr, "bg.png")</pre>
</div>
</div>
<div class="paragraph">
<p>The compiler will issue a warning if the supplied data does not match what the mapper expects.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_file">13.32. <code>file</code></h3>
<div class="paragraph">
<p>The <code>file</code> keyword imports and converts data from an external file.
It is only usable inside of a <a href="#byte_blocks">byte block</a>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>file(target, "filename", args...)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>target</code> specifies the output conversion target to use.</p>
</li>
<li>
<p><code>"filename"</code> is a string literal path to the file.</p>
</li>
<li>
<p><code>args&#8230;&#8203;</code> is a list of arguments that the conversion script will use. (Most conversion scripts do not use arguments.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chrrom
    file(chr, "sprites.png")
    file(chr, "bg.png")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Modifiers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mod_file"><code>+spr_8x16</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Input Filetype Conversions</strong></p>
</div>
<div class="paragraph">
<p>When loading a file, its data is first interpreted based on its <a href="https://en.wikipedia.org/wiki/Filename_extension">filename extension</a>.
The following filenames are accepted:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File Format</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_bin"><code>.bin</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw binary data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_bin"><code>.chr</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw binary data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_bin"><code>.nam</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw binary data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_txt"><code>.txt</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Textual data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_png"><code>.png</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/PNG">PNG image</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Output Target Conversions</strong></p>
</div>
<div class="paragraph">
<p>Once a file has been loaded, it is then converted based on its target.
The following targets are accepted:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conversion Target</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_raw"><code>raw</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw binary data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_fmt"><code>fmt</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formatted data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_pbz"><code>pbz</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed graphical data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#file_rlz"><code>rlz</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressed data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Accessory Definitions</strong></p>
</div>
<div class="paragraph">
<p>In addition to defining a byte sequence, the <code>file</code> keyword may define compile-time constants in the byte block&#8217;s namespace.
These constants will have names prefixed by the previous label and the character <code>_</code>, if such a label exists.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[] compressed_data
    file(pbz, "sprites.png")
    label bg
    file(pbz, "bg.png")</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <a href="#file_pbz"><code>pbz</code> target</a> is used.
This target has two accessory definitions: <code>chunks</code> and <code>tiles</code>.
Thus, <code>compressed_data</code> would gain the following members:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compressed_data.chunks</code></p>
</li>
<li>
<p><code>compressed_data.tiles</code></p>
</li>
<li>
<p><code>compressed_data.bg_chunks</code></p>
</li>
<li>
<p><code>compressed_data.bg_tiles</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the first two refer to the first <code>file</code>, while the second two refer to the second <code>file</code>.
The second two are prefixed with <code>bg_</code>, as the previous label is <code>bg</code>.</p>
</div>
<div class="sect3">
<h4 id="file_bin">13.32.1. Binary file formats</h4>
<div class="paragraph">
<p>The filetypes <code>.bin</code>, <code>.chr</code>, and <code>.nam</code> are loaded as raw binary data, with no conversions happening.</p>
</div>
</div>
<div class="sect3">
<h4 id="file_txt">13.32.2. <code>.txt</code> format</h4>
<div class="paragraph">
<p>The filetype <code>.txt</code> is interpreted as ASCII data, with newline sequences replaced with a single newline character.</p>
</div>
<div class="paragraph">
<p>The following newline sequences are replaced with <code>\n</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>\r</code></p>
</li>
<li>
<p><code>\r\n</code></p>
</li>
<li>
<p><code>\n\r</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>\r</code> has an ASCII value of <code>$0D</code>, and <code>\n</code> has an ASCII value of <code>$0A</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="file_png">13.32.3. <code>.png</code> format</h4>
<div class="paragraph">
<p>The filetype <code>.png</code> is interpreted as a <a href="https://en.wikipedia.org/wiki/PNG">PNG image</a> representing CHR tileset data.
The input image must have dimensions that are multiples of 8 x 8 pixels.</p>
</div>
<div class="paragraph">
<p>If the PNG image is encoded using a palette, the resulting CHR will use the palette indexes as each pixel&#8217;s color, modulo 4.
Otherwise, the PNG will be converted to a grayscale image with pixel values in the range [0, 3];
black represents color 0 and white represents color 3.</p>
</div>
</div>
<div class="sect3">
<h4 id="file_raw">13.32.4. <code>raw</code> target</h4>
<div class="paragraph">
<p>The <code>raw</code> target imports raw binary data, without performing any filetype conversions.
It accepts no arguments.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[] sin_table
    file(raw, "sin_table.bin")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Accessory Definitions</strong></p>
</div>
<div class="paragraph">
<p>There are no accessory definitions for <code>raw</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="file_fmt">13.32.5. <code>fmt</code> target</h4>
<div class="paragraph">
<p>The <code>fmt</code> target imports data after first processing it using filetype conversions.
It accepts no arguments.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chrrom
    file(fmt, "tiles.png")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Accessory Definitions</strong></p>
</div>
<div class="paragraph">
<p>There are no accessory definitions for <code>fmt</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="file_pbz">13.32.6. <code>pbz</code> target</h4>
<div class="paragraph">
<p>The <code>pbz</code> target compresses the data into the PBZ encoding after first processing it using filetype conversions.
It accepts no arguments.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[] compressed_data
    file(pbz, "sprites.png")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Accessory Definitions</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>chunks</code>: An <code>Int</code> equal to the decompressed size divided by 8.</p>
</li>
<li>
<p><code>tiles</code>: An <code>Int</code> equal to the decompressed size divided by 16. If the size is not a multiple of 16, the value is left undefined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Decompressing</strong></p>
</div>
<div class="paragraph">
<p>The standard library file <code>pbz.fab</code> can be used to decompress PBZ-encoded data.</p>
</div>
<div class="paragraph">
<p><strong>Encoding Description</strong></p>
</div>
<div class="paragraph">
<p>PBZ is a simple run-length encoding that is good for representing graphical data.
As it decompresses into chunks of 8 bytes, it won&#8217;t work with arbitrarily-sized data.</p>
</div>
<div class="paragraph">
<p>The data is formatted as a sequence of compressed 8-byte chunks.
The first byte of a chunk encodes it run-length encoding in a unary-encoded format.
For each bit of this byte, starting from the highest bit:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code> bit: Read a byte from the sequence and output it.</p>
</li>
<li>
<p><code>1</code> bit: Output the previous byte outputted for this chunk, or <code>$00</code> if none was.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, given the sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$AF $11 $22</pre>
</div>
</div>
<div class="paragraph">
<p>The unary-encoded byte is <code>$AF</code>, which has the binary representation <code>%10101111</code>.
Starting from the highest bit and working to the lowest bit, the decompressed sequence is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$00 $11 $11 $22 $22 $22 $22 $22</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file_rlz">13.32.7. <code>rlz</code> target</h4>
<div class="paragraph">
<p>The <code>rlz</code> target compresses the data into the RLZ encoding after first processing it using filetype conversions.</p>
</div>
<div class="paragraph">
<p><strong>Arguments</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>1st (optional): Include terminator. If <code>true</code>, the byte sequence will have a <code>$00</code> byte appended onto the end.
If <code>false</code>, no <code>$00</code> will be appended. By default, the value is <code>true</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[] compressed_data
    file(rlz, "sprites.png", false)
    file(rlz, "sprites2.png")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Accessory Definitions</strong></p>
</div>
<div class="paragraph">
<p>There are no accessory definitions for <code>rlz</code>.</p>
</div>
<div class="paragraph">
<p><strong>Decompressing</strong></p>
</div>
<div class="paragraph">
<p>The standard library file <code>rlz.fab</code> can be used to decompress RLZ-encoded data.</p>
</div>
<div class="paragraph">
<p><strong>Encoding Description</strong></p>
</div>
<div class="paragraph">
<p>RLZ is a simple run-length encoding that&#8217;s good for data with long sequences of repeating bytes.</p>
</div>
<div class="paragraph">
<p>The data is formatted as a sequence of runs, where the first byte, N, of a run determines the effect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$00</code> byte: Terminate the data sequence.</p>
</li>
<li>
<p><code>$01</code> to <code>$7F</code> byte: Copy the next byte, (N + 2) times.</p>
</li>
<li>
<p><code>$80</code> to <code>$FF</code> byte: Copy the next (N - 127) bytes verbatim.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, given the sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$03 $11 $81 $22 $33 $02 $44 $00</pre>
</div>
</div>
<div class="paragraph">
<p>The decompressed sequence is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$01 $01 $01 $01 $01 $22 $33 $44 $44 $44 $44</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_audio">13.33. <code>audio</code></h3>
<div class="paragraph">
<p>The <code>audio</code> keyword imports and converts audio data from an external file,
converting the data into code definitions.
It is only usable at top-level scope.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>audio(target, args...)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>target</code> specifies the output target to use.</p>
</li>
<li>
<p><code>args&#8230;&#8203;</code> is a list of arguments that the conversion script will use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>audio(puf1_music, "music.txt")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output Targets</strong></p>
</div>
<div class="paragraph">
<p>The following targets are accepted:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conversion Target</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"><a href="#audio_puf1_music"><code>puf1_music</code></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Music</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#audio_puf1_music"><code>puf1_sfx</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sound Effects</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="audio_puf1_music">13.33.1. <code>puf1_music</code> target</h4>
<div class="paragraph">
<p>The <code>puf1_music</code> target converts music data and generates code compatible with the PUF music engine.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>audio(puf1_music, "music.txt")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>1st (optional): Filename as a string literal.
The file should be a <code>.txt</code> file exported by <a href="http://famitracker.com/">FamiTracker</a>.
If this argument is left out, definitions will still be generated, albeit with zero tracks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Definitions</strong></p>
</div>
<div class="paragraph">
<p>Every generated definition will be prefixed with <code>puf_</code>, and will have <code>/puf_data</code> or <code>/puf_omni</code> as its group.</p>
</div>
<div class="paragraph">
<p>Because tracks are indexed by number, <code>puf1_music</code> enumerates each track with a compile-time constant definition.
The names of these definitions are prefixed with <code>puf_track_</code>, followed by the track&#8217;s name converted to lowercase,
with <code>_</code> characters replacing spaces and other special characters.</p>
</div>
<div class="paragraph">
<p>For example, if the tracks are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Main Menu
Game Play 1
Death</pre>
</div>
</div>
<div class="paragraph">
<p>The following definitions would be defined by <code>puf1_music</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct U puf_track_main_menu   = 0
ct U puf_track_game_play_1 = 1
ct U puf_track_death       = 2</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Use</strong></p>
</div>
<div class="paragraph">
<p>The standard library file <code>puf1.fab</code> can be used to play the converted music.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will also need a <code>puf1_sfx</code> audio target.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="audio_puf1_sfx">13.33.2. <code>puf1_sfx</code> target</h4>
<div class="paragraph">
<p>The <code>puf1_sfx</code> target converts sound effect data and generates code compatible with the PUF music engine.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>audio(puf1_sfx, "music.txt", "music.nsf")</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>1st (optional): Filename as a string literal.
The file should be a <code>.txt</code> file exported by <a href="http://famitracker.com/">FamiTracker</a>.
If this argument is left out, definitions will still be generated, albeit with zero sound effects.</p>
</li>
<li>
<p>2nd (optional): Filename as a string literal.
The file should be a <code>.nsf</code> file exported by <a href="http://famitracker.com/">FamiTracker</a>,
from the same project as the <code>.txt</code>.
If both arguments are left out, definitions will still be generated, albeit with zero sound effects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Definitions</strong></p>
</div>
<div class="paragraph">
<p>Every generated definition will be prefixed with <code>puf_</code>, and will have <code>/puf_data</code> or <code>/puf_omni</code> as its group.</p>
</div>
<div class="paragraph">
<p>Because sound effects are indexed by number, <code>puf1_sfx</code> enumerates each track with a compile-time constant definition.
The names of these definitions are prefixed with <code>puf_sfx_</code>, followed by the sound effect track&#8217;s name converted to lowercase,
with <code>_</code> characters replacing spaces and other special characters.</p>
</div>
<div class="paragraph">
<p>For example, if the sound effect tracks are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Attack
Double Jump
Death</pre>
</div>
</div>
<div class="paragraph">
<p>The following definitions would be defined by <code>puf1_sfx</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct U puf_sfx_attack      = 0
ct U puf_sfx_double_jump = 1
ct U puf_sfx_death       = 2</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Use</strong></p>
</div>
<div class="paragraph">
<p>The standard library file <code>puf1.fab</code> can be used to play the converted sound effects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will also need a <code>puf1_music</code> audio target.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kw_stows">13.34. <code>stows</code></h3>
<div class="paragraph">
<p>See <a href="#mod_stows"><code>stows</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="kw_employs">13.35. <code>employs</code></h3>
<div class="paragraph">
<p>See <a href="#mod_employs"><code>employs</code></a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modifiers">14. Modifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modifiers add additional metadata to definitions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U x) U
: employs /bar
: +align
    return x + x</pre>
</div>
</div>
<div class="sect2">
<h3 id="mod_flags">14.1. Modifier Flags</h3>
<div class="paragraph">
<p>Modifier flags are specified prefixed with a <code>-</code> or <code>+</code> character.
<code>-</code> is used to disable the modifier, while <code>+</code> is used to enable it.</p>
</div>
<div class="paragraph">
<p>The following flags exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+inline</code>, <code>-inline</code>: Force / prevent the function from being inlined.</p>
</li>
<li>
<p><code>+align</code>: Aligns the data to fit inside a 256-byte page (or to 256 bytes otherwise).</p>
</li>
<li>
<p><code>+zero_page</code>, <code>-zero_page</code>: Force / prevent variables from using fast zero-page RAM.</p>
</li>
<li>
<p><code>+spr_8x16</code>: Reorders <a href="#kw_file"><code>file</code></a> CHR data from 8x16 tiles to 8x8 tiles.</p>
</li>
<li>
<p><code>+graphviz</code>: Output the function&#8217;s intermediate representation in a graphviz file.</p>
</li>
<li>
<p><code>+info</code>: Output the function&#8217;s intermediate representation in a text file.</p>
</li>
<li>
<p><code>+dpcm</code>: Align and store the data in a ROM location suitable for DPCM.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn foo(U x) U
: -inline
: +align
: +graphviz
    return x + x</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mod_stows">14.2. <code>stows</code></h3>
<div class="paragraph">
<p>The <code>stows</code> <a href="#modifiers">modifier</a> is used inside <a href="#kw_charmap"><code>charmap</code></a> definitions
to enable string literals to use said <code>charmap</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: stows /group_name</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_name</code> is a single <code>data</code> group which string literals will be stored in.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mod_employs">14.3. <code>employs</code></h3>
<div class="paragraph">
<p>The <code>employs</code> <a href="#modifiers">modifier</a> instructs a function to be dependent on a group.
From the time the function is called to the time the function returns,
the memory associated with that group will be usable by the function.</p>
</div>
<div class="paragraph">
<p>Normally, the compiler automatically infers the groups a function depends on.
The <code>employs</code> modifier is only required in these circumstances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value is read or written using a hardware address (type <code>AA</code> or <code>AAA</code>).</p>
</li>
<li>
<p>The modified function is an <a href="#kw_asm"><code>asm fn</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: employs /group_names</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_names</code> is an optional list of groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mod_preserves">14.4. <code>preserves</code></h3>
<div class="paragraph">
<p>The <code>preserves</code> <a href="#modifiers">modifier</a> is used inside a <a href="#kw_goto_mode_statement"><code>goto mode</code> statement</a>
to specify which variables are kept, and which are reset to their initial value.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: preserves /group_names</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_names</code> is an optional list of <code>vars</code> groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a global variable is not in a preserved group, it will be reset to its initial value if one exists.
If no initial value was specified, the value will enter an undefined (garbage) state.</p>
</div>
</div>
<div class="sect2">
<h3 id="mod_data">14.5. <code>data</code></h3>
<div class="paragraph">
<p>The <code>data</code> <a href="#modifiers">modifier</a> is used to document which <code>data</code> <a href="#groups">groups</a> a function uses.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: data /group_names</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_names</code> is an optional list of <code>data</code> groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The function will be checked by the compiler to ensure it only uses data from the listed groups.</p>
</div>
</div>
<div class="sect2">
<h3 id="mod_vars">14.6. <code>vars</code></h3>
<div class="paragraph">
<p>The <code>vars</code> <a href="#modifiers">modifier</a> is used to document which <code>vars</code> <a href="#groups">groups</a> a function uses.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: vars /group_names</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/group_names</code> is an optional list of <code>data</code> groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The function will be checked by the compiler to ensure it only uses variables from the listed groups.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operators_2">15. Operators</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_operator_tables">15.1. Operator Tables</h3>
<div class="sect3">
<h4 id="unary_ops">15.1.1. Unary Operators</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Operators with lower precedence numbers come earlier in the order of operations.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Precedence</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get_pointer">Get Pointer <code>@</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get_hw_addr">Get Hardware Address <code>&amp;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unary_plus">Unary Plus <code>+</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unary_negate">Unary Negate <code>-</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unary_bitwise_not">Unary Bitwise NOT <code>~</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#unary_logical_not">Unary Logical NOT <code>!</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="binop">15.1.2. Binary Operators</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Operators with lower precedence numbers come earlier in the order of operations.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Precedence</th>
<th class="tableblock halign-left valign-top">Associativity</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#member_access">Member Access <code>.</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#multiply">Multiply <code>*</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#add">Add <code>+</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#subtract">Subtract <code>-</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;-&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rotate_left">Rotate Left <code>&lt;-&lt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;-&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rotate_right">Rotate Right <code>&gt;-&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#shift_left">Shift Left <code>&lt;&lt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#shift_right">Shift Right <code>&gt;&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bitwise_and">Bitwise AND <code>&amp;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bitwise_xor">Bitwise XOR <code>^</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#bitwise_or">Bitwise OR <code>|</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#less_than">Less Than <code>&lt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#less_than_or_equal_to">Less Than or Equal To <code>&lt;=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#greater_than">Greater Than <code>&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#greater_than_or_equal_to">Greater Than or Equal To <code>&gt;=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#equal_to">Equal To <code>==</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#not_equal_to">Not Equal To <code>!=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#logical_and">Logical AND <code>&amp;&amp;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#logical_or">Logical OR <code>||</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_rotate_left">Assign by Rotate Left <code>&lt;=&lt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_rotate_right">Assign by Rotate Right <code>&gt;=&gt;</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_multiply">Assign by Multiply (<code>*=</code>)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_add">Assign by Add <code>+=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_subtract">Assign by Subtract <code>-=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_shift_left">Assign by Shift Left <code>&lt;&lt;=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_shift_right">Assign by Shift Right <code>&gt;&gt;=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_bitwise_and">Assign by Bitwise AND <code>&amp;=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_bitwise_xor">Assign by Bitwise XOR <code>^=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign_bitwise_or">Assign by Bitwise OR <code>|=</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#assign">Assign <code>=</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="fnop">15.1.3. Function-like Operators</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All function-like operators have left associativity and evaluate first in the order of operations.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>fn_expression</em>(<em>argument_expressions</em>&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fn_call">Function Call</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>Type</em>(<em>argument_expressions</em>&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#casts">Explicit Type Cast</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sizeof <em>Type</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sizeof_type">Size of a Type</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sizeof(<em>expression</em>)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#sizeof_expr">Size of an Expression</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>len <em>Type</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#len_type">Array Length of a Type</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>len(<em>expression</em>)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#len_expr">Array Length of an Expression</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>array_expression</em>[<em>index_expression</em>]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#array_access_u">U-Indexed Array/Pointer Access</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>array_expression</em>{<em>index_expression</em>}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#array_access_uu">UU-Indexed Array/Pointer Access</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{<em>address_expression</em>}()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hw_read">Hardware Read</a>&gt;&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{<em>address_expression</em>}(<em>value_expression</em>)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hw_write">Hardware Write</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_operator_listings">15.2. Operator Listings</h3>
<div class="sect3">
<h4 id="get_pointer">15.2.1. Get Pointer <code>@</code></h4>
<div class="paragraph">
<p>Converts an lvalue <a href="#type_paa">pointer-addressable array</a> into a corresponding pointer.</p>
</div>
</div>
<div class="sect3">
<h4 id="get_hw_addr">15.2.2. Get Hardware Address <code>&amp;</code></h4>
<div class="paragraph">
<p>Converts an lvalue into its corresponding hardware address, of type <code>AA</code> or <code>AAA</code>.</p>
</div>
<div class="paragraph">
<p>This operator is intended to be used with inline assembly code.
Although this operator by itself is safe, dereferencing the addresses it returns can easily cause undefined behavior.
For regular code, it&#8217;s recommended to use <a href="#get_pointer">Get Pointer <code>@</code></a> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="unary_plus">15.2.3. Unary Plus <code>+</code></h4>
<div class="paragraph">
<p>Returns its operand, type and value unchanged. The operand must be an <a href="#type_arithmetic">arithmetic type</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+100 // Equivalent to 100</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unary_negate">15.2.4. Unary Negate <code>-</code></h4>
<div class="paragraph">
<p>Returns its operand subtracted from zero, type unchanged. The operand must be an <a href="#type_arithmetic">arithmetic type</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-100 // Equivalent to (0 - 100)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unary_bitwise_not">15.2.5. Unary Bitwise NOT <code>~</code></h4>
<div class="paragraph">
<p>Returns its operand with every bit flipped (1 becomes 0, and vice versa), type unchanged. The operand must be an <a href="#type_arithmetic">arithmetic type</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U bits = %1010
~bits // Equivalent to %11110101</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unary_logical_not">15.2.6. Unary Logical NOT <code>!</code></h4>
<div class="paragraph">
<p>Returns its operand, converted to type <code>Bool</code>, then negated (<code>true</code> becomes <code>false</code> and vice versa). The operand must be an <a href="#type_arithmetic">arithmetic type</a>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>!0     // Equivalent to true
!5     // Equivalent to false
!true  // Equivalent to false
!false // Equivalent to true</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="member_access">15.2.7. Member Access <code>.</code></h4>
<div class="paragraph">
<p>Operator <code>.</code> is used to access members and nested values, and works similarly to other languages.
Its behavior depends on the left hand side of the operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <a href="#type_struct">structure values</a>, returns the specified member as an lvalue.</p>
</li>
<li>
<p>For <a href="#kw_fn"><code>fn</code> values</a> and <a href="#type_paa">PAA values</a>, returns the <a href="#kw_ct"><code>ct</code></a> value in its scope.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if the left hand side is an <a href="#kw_asm"><code>asm fn</code></a> and the right hand side is a <a href="#kw_label_asm"><code>label</code></a>,
the result is a callable function with the label being the entry point.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo.bar = 10               // Modify a struct member
some_asm_fn.some_label(10) // Call an assembly function</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiply">15.2.8. Multiply <code>*</code></h4>
<div class="paragraph">
<p>Returns its operands multiplied together, of a type large enough to hold the product.
The return type is signed if either operand is signed, but unsigned otherwise.
The operands must be <a href="#type_quantity">quantity types</a>.</p>
</div>
<div class="paragraph">
<p>To be more precise, if the operand types have <code>F</code> and <code>F'</code> fractional bytes, the return type will have <code>F + F'</code>.
Likewise, if the operand types have <code>W</code> and <code>W'</code> whole bytes, the return type will have <code>W + W'</code>.
The return type will be truncated to fit the compiler&#8217;s available types.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>5 * 3             // Equivalent to 15, of type Int
U(5) * U(8)       // Equivalent to 40, of type UU
UF(5.5) * SS(-10) // Equivalent to -55, of type SSSF</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Multiplying two variables together is a very slow operation,
but multiplying a variable by a constant is faster since the compiler can convert the expression to a sequence of shifts and adds.
However, if you need to do lots of multiplications, consider using lookup tables instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assign_multiply">15.2.9. Assign by Multiply (<code>*=</code>)</h4>
<div class="paragraph">
<p>Multiplies its operands together, then assigns the value to the lvalue left operand, converting as needed.
Returns the left operand&#8217;s new value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U a
a *= b // Equivalent to a = U(a * b)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add">15.2.10. Add <code>+</code></h4>
<div class="paragraph">
<p>Returns the sum of its operands.
The operands must be of the same <a href="#type_quantity">quantity type</a>, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 + 7 // Equivalent to 10</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assign_add">15.2.11. Assign by Add <code>+=</code></h4>
<div class="paragraph">
<p>Converts the right operand to the left operand&#8217;s type, then performs an addition using both operands and assigns the value to the lvalue left operand.
Return the carry: a value of type <code>Bool</code> that is <code>true</code> when the resulting sum overflowed, and <code>false</code> otherwise.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U x = 200
x += 50  // 'x' is now equal to 50. The expression returns 'false'.
x += 100 // 'x' is now equal to 94 due to overflow. The expression returns 'true'.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unlike in other languages, this operator doesn&#8217;t return its left operand.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="subtract">15.2.12. Subtract <code>-</code></h4>
<div class="paragraph">
<p>Returns the difference of its operands (the right operand subtracted from the left).
The operands must be of the same <a href="#type_quantity">quantity type</a>, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10 - 7 // Equivalent to 3</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assign_subtract">15.2.13. Assign by Subtract <code>-=</code></h4>
<div class="paragraph">
<p>Converts the right operand to the left operand&#8217;s type, then performs a subtraction using both operands and assigns the value to the lvalue left operand.
Return the carry: a value of type <code>Bool</code> that is <code>false</code> when the resulting sum underflowed, and <code>true</code> otherwise.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U x = 200
x -= 50  // 'x' is now equal to 150. The expression returns 'true'.
x -= 300 // 'x' is now equal to 106 due to underflow. The expression returns 'false'.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rotate_left">15.2.14. Rotate Left <code>&lt;-&lt;</code></h4>
<div class="paragraph">
<p>Moves each of the bits of the left operand one place to the left, with the lowest bit being filled with the value of the right operand.
The left operand must be a <a href="#type_quantity">type_quantity</a>, and the right operand must be type <code>Bool</code>.
The return type matches the left operand&#8217;s type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11001010) &lt;-&lt; false // Equivalent to U(%10010100)
U(%11001010) &lt;-&lt; true  // Equivalent to U(%10010101)
U(%01111111) &lt;-&lt; false // Equivalent to U(%11111110)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assign_rotate_left">15.2.15. Assign by Rotate Left <code>&lt;=&lt;</code></h4>
<div class="paragraph">
<p>Performs a left rotation using both operands, then assigns the value to the lvalue left operand.
Returns the carry: a value of type <code>Bool</code> equal to left operand&#8217;s highest bit prior to the operation.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11001010
foo &lt;=&lt; false // Sets 'foo' to U(%10010100). Returns true.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rotate_right">15.2.16. Rotate Right <code>&gt;-&gt;</code></h4>
<div class="paragraph">
<p>Moves each of the bits of the right operand one place to the right, with the highest bit being filled with the value of the left operand.
The right operand must be a <a href="#type_quantity">type_quantity</a>, and the left operand must be type <code>Bool</code>.
The return type matches the right operand&#8217;s type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>false &gt;-&gt; U(%11001010) // Equivalent to U(%01100101)
true  &gt;-&gt; U(%11001010) // Equivalent to U(%11100101)
false &gt;-&gt; U(%11111110) // Equivalent to U(%01111111)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This operation corresponds to the 6502 assembly instruction <code>ROR</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assign_rotate_right">15.2.17. Assign by Rotate Right <code>&gt;=&gt;</code></h4>
<div class="paragraph">
<p>Performs a right rotation using both operands, then assigns the value to the lvalue right operand.
Returns the carry: a value of type <code>Bool</code> equal to right operand&#8217;s lowest bit prior to the operation.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11001010
false &gt;=&gt; foo // Sets 'foo' to %01100101. Returns false.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This operator requires an lvalue on the right side of the operator, which is unlike other assignment operators.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="shift_left">15.2.18. Shift Left <code>&lt;&lt;</code></h4>
<div class="paragraph">
<p>Moves each of the bits of the left operand to the left N places, where N is the right operand of type <code>U</code>,
and filling blank spaces with <code>0</code>.
The return type matches the left operand&#8217;s type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11110001) &lt;&lt; 1 // Equivalent to U(%11100010)
U(%11110001) &lt;&lt; 3 // Equivalent to U(%10001000)</pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia on Bitwise Operations</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The NES performs shifts one bit at a time, meaning <code>x &lt;&lt; 1</code> is five times faster than <code>x &lt;&lt; 5</code>,
and shifting by a variable (<code>x &lt;&lt; y)</code> generates a loop in the assembly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assign_shift_left">15.2.19. Assign by Shift Left <code>&lt;&lt;=</code></h4>
<div class="paragraph">
<p>Performs a left shift using both operands, then assigns the value to the lvalue left operand.
Returns the carry: a value of type <code>Bool</code> equal to last bit shifted out (or <code>false</code> if no shifting occured).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11001010
foo &lt;&lt;= 2 // Sets 'foo' to U(%00101000). Returns true.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unlike in other languages, this operator doesn&#8217;t return its left operand.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="shift_right">15.2.20. Shift Right <code>&gt;&gt;</code></h4>
<div class="paragraph">
<p>Moves each of the bits of the left operand to the right N places, where N is the right operand of type <code>U</code>.
If the left operand is unsigned, the blank spaces are filled with <code>0</code>,
otherwise the blank spaces are filled with the highest bit of the left operand (this is called sign extension).
The return type matches the left operand&#8217;s type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11110001) &gt;&gt; 1 // Equivalent to U(%01111000)
S(%11110001) &gt;&gt; 1 // Equivalent to S(%11111000)
U(%11110001) &gt;&gt; 3 // Equivalent to U(%00011110)
S(%11110001) &gt;&gt; 3 // Equivalent to S(%11111110)
S(%01110001) &gt;&gt; 3 // Equivalent to S(%00001110)</pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia on Bitwise Operations</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The NES performs shifts one bit at a time, meaning <code>x &gt;&gt; 1</code> is five times faster than <code>x &gt;&gt; 5</code>,
and shifting by a variable (<code>x &gt;&gt; y)</code> generates a loop in the assembly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="assign_shift_right">15.2.21. Assign by Shift Right <code>&gt;&gt;=</code></h4>
<div class="paragraph">
<p>Performs a right shift using both operands, then assigns the value to the lvalue left operand.
Returns the carry: a value of type <code>Bool</code> equal to last bit shifted out (or <code>false</code> if no shifting occured).</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11001010
foo &gt;&gt;= 2 // Sets 'foo' to U(%00110010). Returns true.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unlike in other languages, this operator doesn&#8217;t return its left operand.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="bitwise_and">15.2.22. Bitwise AND <code>&amp;</code></h4>
<div class="paragraph">
<p>Applies the AND operation across each bit of the operands, returning the result.
The operands must be of the same <a href="#type_arithmetic">arithmetic type</a>, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11110000) &amp; U(%10101010) // Equivalent to U(%10100000)</pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia on Bitwise Operations</a></p>
</div>
</div>
<div class="sect3">
<h4 id="assign_bitwise_and">15.2.23. Assign by Bitwise AND <code>&amp;=</code></h4>
<div class="paragraph">
<p>Converts the right operand to the left operand&#8217;s type, then performs a bitwise AND using both operands and assigns the value to the lvalue left operand.
Returns the left operand&#8217;s new value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11110000
foo &amp;= %10101010 // Sets 'foo' to U(%10100000)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bitwise_xor">15.2.24. Bitwise XOR <code>^</code></h4>
<div class="paragraph">
<p>Applies the XOR operation across each bit of the operands, returning the result.
The operands must be of the same <a href="#type_arithmetic">arithmetic type</a>, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11110000) ^ U(%10101010) // Equivalent to U(%01011010)</pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia on Bitwise Operations</a></p>
</div>
</div>
<div class="sect3">
<h4 id="assign_bitwise_xor">15.2.25. Assign by Bitwise XOR <code>^=</code></h4>
<div class="paragraph">
<p>Converts the right operand to the left operand&#8217;s type, then performs a bitwise XOR using both operands and assigns the value to the lvalue left operand.
Returns the left operand&#8217;s new value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11110000
foo ^= %10101010 // Sets 'foo' to U(%01011010)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bitwise_or">15.2.26. Bitwise OR <code>|</code></h4>
<div class="paragraph">
<p>Applies the OR operation across each bit of the operands, returning the result.
The operands must be of the same <a href="#type_arithmetic">arithmetic type</a>, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(%11110000) | U(%10101010) // Equivalent to U(%11111010)</pre>
</div>
</div>
<div class="paragraph">
<p>See: <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia on Bitwise Operations</a></p>
</div>
</div>
<div class="sect3">
<h4 id="assign_bitwise_or">15.2.27. Assign by Bitwise OR <code>|=</code></h4>
<div class="paragraph">
<p>Converts the right operand to the left operand&#8217;s type, then performs a bitwise OR using both operands and assigns the value to the lvalue left operand.
Returns the left operand&#8217;s new value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo = %11110000
foo |= %10101010 // Sets 'foo' to U(%11111010)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logical_and">15.2.28. Logical AND <code>&amp;&amp;</code></h4>
<div class="paragraph">
<p>Implements the <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">"short-circuit"</a> version of the AND operation from boolean logic.</p>
</div>
<div class="paragraph">
<p>Evaluates the left operand and converts it to <code>Bool</code>. If it is <code>false</code>, the operator returns <code>false</code>.
Otherwise, it evaluates the right operand and returns its value converted to <code>Bool</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>false &amp;&amp; false  // Returns false
true  &amp;&amp; false  // Returns false
false &amp;&amp; true   // Returns false
true  &amp;&amp; true   // Returns true</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logical_or">15.2.29. Logical OR <code>||</code></h4>
<div class="paragraph">
<p>Implements the <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">"short-circuit"</a> version of the OR operation from boolean logic.</p>
</div>
<div class="paragraph">
<p>Evaluates the left operand and converts it to <code>Bool</code>. If it is <code>true</code>, the operator returns <code>true</code>.
Otherwise, it evaluates the right operand and returns its value converted to <code>Bool</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>false || false  // Returns false
true  || false  // Returns true
false || true   // Returns true
true  || true   // Returns true</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="less_than">15.2.30. Less Than <code>&lt;</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is less than the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 &lt;  10 // Returns true
3 &lt; -10 // Returns false</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="less_than_or_equal_to">15.2.31. Less Than or Equal To <code>&lt;=</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is less than or equal to the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 &lt;= 3   // Returns true
3 &lt;= -10 // Returns false</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="greater_than">15.2.32. Greater Than <code>&gt;</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is greater than the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 &gt;  10 // Returns false
3 &gt; -10 // Returns true</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="greater_than_or_equal_to">15.2.33. Greater Than or Equal To <code>&gt;=</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is greater than or equal to the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 &gt;= 3  // Returns true
3 &gt;= 10 // Returns false</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="equal_to">15.2.34. Equal To <code>==</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is equal to the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 == 3  // Returns true
3 == 10 // Returns false</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="not_equal_to">15.2.35. Not Equal To <code>!=</code></h4>
<div class="paragraph">
<p>Compares the <a href="#type_arithmetic">arithmetic type</a> operands, returning <code>true</code> if the left operand is equal to the right and <code>false</code> otherwise.
The operands may be of different types. No types conversions occur besides <code>Int</code> and <code>Real</code> conversions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 != 3  // Returns false
3 != 10 // Returns true</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assign">15.2.36. Assign <code>=</code></h4>
<div class="paragraph">
<p>Stores the right operand into the left and returns the new value of the left operand.
The right operand must have the same type as the left operand, although <code>Int</code> and <code>Real</code> will convert.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U foo
foo = 10 // 'foo' is now equal to 10</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="array_access">15.3. Array and pointer access</h3>
<div class="sect3">
<h4 id="array_access_u">15.3.1. <code>[]</code> U-indexed access</h4>
<div class="paragraph">
<p>Accesses the element value at an offset of type U, with 0-based indexing.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>value[offset]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> is an expression with a <a href="#type_tea">TEA type</a> or a pointer to a <a href="#type_paa">PAA type</a>.</p>
</li>
<li>
<p><code>offset</code> is an expression of type <code>U</code>, used as the offset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>array[20] = 10    // Set a TEA element
x = @paa[10]      // Read a PAA element</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="array_access_uu">15.3.2. <code>{}</code> UU-indexed access</h4>
<div class="paragraph">
<p>Accesses the element value at an offset of type UU, with 0-based indexing.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>value[offset]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> is an expression with a <a href="#type_tea">TEA type</a> or a pointer to a <a href="#type_paa">PAA type</a>.</p>
</li>
<li>
<p><code>offset</code> is an expression of type <code>UU</code>, used as the offset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>array{2000} = 10    // Set a TEA element
x = @paa{1000}      // Read a PAA element</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>{}</code> often has significantly worse performance than <code>[]</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hardware_operators">15.4. Hardware operators</h3>
<div class="sect3">
<h4 id="hw_read">15.4.1. <code>{}()</code> Hardware read</h4>
<div class="paragraph">
<p>Returns the value at a RAM address.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{address}()</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>address</code> is a value of type <a href="#type_address"><code>AA</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U status = {PPUSTATUS}() // Read the PPU's status register</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To correctly read a NESFab variable this way, a <a href="#kw_fence"><code>fence</code></a> is required, along with <a href="#kw_employs"><code>employs</code></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hw_write">15.4.2. <code>{}()</code> Hardware write</h4>
<div class="paragraph">
<p>Assigns a value at a hardware address.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{address}(value)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>address</code> is a value of type <a href="#type_address"><code>AA</code></a>.</p>
</li>
<li>
<p><code>value</code> is an expression of type <code>U</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{PPUDATA}($80) // Write to the PPU's data register</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To correctly write a NESFab variable this way, a <a href="#kw_fence"><code>fence</code></a> is required, along with <a href="#kw_employs"><code>employs</code></a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fn_call">15.5. Function calls</h3>
<div class="paragraph">
<p>Calls the named function
It behaves similarly to function calls in other languages.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn_expression(argument_expressions...)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fn_expression</code> is the function to be called.</p>
</li>
<li>
<p><code>argument_expressions</code> are a comma-separated list of expressions to be passed to the function as argument.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo(1, 2, 3)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sizeof">15.6. <code>sizeof</code></h3>
<div class="paragraph">
<p><code>sizeof</code> expressions return the size in bytes of something.</p>
</div>
<div class="sect3">
<h4 id="sizeof_type">15.6.1. <code>sizeof</code> Type</h4>
<div class="paragraph">
<p>Returns the size in bytes of values belonging to a type as a compile-time constant value of type <code>Int</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sizeof Type</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Type</code> is a type name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct Int uu_size = sizeof UU</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sizeof_expr">15.6.2. <code>sizeof</code>(expression)</h4>
<div class="paragraph">
<p>Returns the size in bytes of an expression&#8217;s value as a compile-time constant value of type <code>Int</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sizeof(expression)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expression</code> is an expression to calculate the size of. The expression will not be executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct Int expr_size = sizeof(1 + 2 + 3)</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="len">15.7. <code>len</code></h3>
<div class="paragraph">
<p><code>len</code> expressions return the number of array elements.</p>
</div>
<div class="sect3">
<h4 id="len_type">15.7.1. <code>len</code> Type</h4>
<div class="paragraph">
<p>Returns the number of array elements of values belonging to a type as a compile-time constant value of type <code>Int</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sizeof Type</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Type</code> is a <a href="#type_tea">typed element array type</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct Int array_len = len UU[10]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="len_expr">15.7.2. <code>len</code>(expression)</h4>
<div class="paragraph">
<p>Returns the number of array elements of an expression&#8217;s value as a compile-time constant value of type <code>Int</code>.</p>
</div>
<div class="paragraph">
<p>Syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sizeof(expression)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expression</code> is an array expression to calcalute the length of. The expression will not be executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct Int expr_len = sizeof(U[10](3))</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="casts">15.8. Explicit Type Casts</h3>
<div class="paragraph">
<p>Type casts convert values into different types.</p>
</div>
<div class="paragraph">
<p>Basic syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Type(value)</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>type</code> is any type name, and <code>value</code> is any expression.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    U some_u = 10
    SS some_ss = SS(some_u)    // An explicit cast to SS
    UUF some_uuf = UUF(some_u) // An explicit cast to UUF</pre>
</div>
</div>
<div class="sect3">
<h4 id="_zero_initializations">15.8.1. Zero Initializations</h4>
<div class="paragraph">
<p>A type cast with no arguments is called a zero initialization.
The value, its struct members, and its array elements are initialized to zero.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U()          // equivalent to U(0)
UF()         // equivalent to U(0.0)
U[3]()       // equivalent to U[3](0, 0, 0)
SomeStruct() // equivalent to SomeStruct(0, 0)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array_fills">15.8.2. Array Fills</h4>
<div class="paragraph">
<p>Array fills are used to create arrays where every element holds identical values.
They are specified as an array cast, where the cast&#8217;s singular argument can be converted to the element type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>S[2](50) // equivalent to S[2](50, 50)
U[5](11) // equivalent to U[5](11, 11, 11, 11, 11)</pre>
</div>
</div>
<div class="paragraph">
<p>The meaning of the indentation is determined by the first line - it might be a construct like <code>if</code> or <code>else</code>,
a definition like a function, or something else.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literals">16. Literals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_boolean_literals">16.1. Boolean Literals</h3>
<div class="paragraph">
<p>There are two boolean literals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kw_true"><code>true</code></a></p>
</li>
<li>
<p><a href="#kw_false"><code>false</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boolean literals have the type <code>Bool</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_numeric_literals">16.2. Numeric Literals</h3>
<div class="paragraph">
<p>Numeric literals can be either decimal, hexadecimal, or or binary. Hexadecimal literals are prefixed with a <code>$</code> character, while binary with <code>%</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1234  // Decimal
$89AB // Hexadecimal
%1010 // Binary</pre>
</div>
</div>
<div class="paragraph">
<p>Literals can use decimal points:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>12.34  // Decimal
$.89AB // Hexadecimal
%1010. // Binary</pre>
</div>
</div>
<div class="paragraph">
<p>Literals with decimal points have the type <code>Real</code>, while those without are <code>Int</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_string_and_character_literals">16.3. String and Character Literals</h3>
<div class="sect3">
<h4 id="_syntax_and_semantics">16.3.1. Syntax and Semantics</h4>
<div class="paragraph">
<p>Basic syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>'c'   // Character using the default charmap
"NES" // Uncompressed string using the default charmap
`NES` // Compressed string using the default charmap

'c'some_charmap   // Character using a specific charmap
"NES"some_charmap // Uncompressed string using a specific charmap
`NES`some_charmap // Compressed string using a specific charmap</pre>
</div>
</div>
<div class="paragraph">
<p>Character literals have the type <code>U</code>. String literals have the type <code>U[N]</code>, where <code>N</code> is the length of the string.</p>
</div>
<div class="paragraph">
<p>Each string and character literal uses a <code>charmap</code>
to translate the characters from Unicode into the <code>charmap&#8217;s range.
The `charmap</code> is set by an identifier following the literal.
If no identifier follows, the default <code>charmap</code> is used.</p>
</div>
<div class="paragraph">
<p>Strings can be uncompressed or compressed.
Compressed strings use a <a href="https://en.wikipedia.org/wiki/Byte_pair_encoding">byte-pair encoding</a>,
where unused values in the charmap represent pairs of bytes.
These pairs are expanded recursively to decompress the string.</p>
</div>
<div class="paragraph">
<p>The nice thing about byte-pair encoding is that uncompressed strings are valid under the encoding too.
This means functions for compressed strings also work with uncompressed strings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_escape_sequences">16.3.2. Escape Sequences</h4>
<div class="paragraph">
<p>Escape sequences denote characters that are either impossible or unwiedly to write otherwise.
Every escape sequence begins with backslash character <code>\</code>, followed by one or more characters.</p>
</div>
<div class="paragraph">
<p>For example, to denote the apostrophe character, you must use an escape sequence, as <code>'''</code> is not valid syntax.
Likewise, to write a string containing line breaks, you must use escape sequences.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>'\''            // An apostrophe character literal
"Hello\nWorld!" // A multi-line string literal</pre>
</div>
</div>
<div class="paragraph">
<p>The valid escape sequences are listed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Escape Sequence</th>
<th class="tableblock halign-left valign-top">Unicode Code Point</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sentinel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$07</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bell or alert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$08</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vertical tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Form feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$0D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carriage return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quotation mark</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apostrophe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\\</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$5C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backslash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\`</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backtick</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$FFFFFFFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Special meaning for <code>charmap</code> definitions</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Unicode code points can also be specified directly. Below, each N character represents any hexadecimal digit.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Escape Sequence</th>
<th class="tableblock halign-left valign-top">Unicode Code Point</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\xNN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$NN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\uNNNN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$NNNN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\UNNNNNNNN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$NNNNNNNN</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types">17. Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scalar_types">17.1. Scalar Types</h3>
<div class="sect3">
<h4 id="type_integer">17.1.1. Integer Types</h4>
<div class="paragraph">
<p>Unsigned integer types are expressed using the character <code>U</code>, while signed integer types use <code>S</code>.
The values of signed integers are expressed in <a href="https://en.wikipedia.org/wiki/Two%27s_complement">two&#8217;s complement</a> form.</p>
</div>
<div class="paragraph">
<p>The 6 integer types are listed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>U</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[0, 255]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>S</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-128, 127]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UU</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[0, 65535]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-32768, 32767]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UUU</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[0, 16777215]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-8388608, 8388607]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_unit_fractional_types">17.1.2. Unit-Fractional Types</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0.00, $0.FF]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0.0000, $0.FFFF]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0.000000, $0.FFFFFF]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type_fixed">17.1.3. Fixed-point Types</h4>
<div class="paragraph">
<p>An integer type and a unit-fractional type can be combined to form a fixed-point type, merging the ranges of both.
The syntax is the integer type, followed by the unit-fractional type, without no other characters in-between.</p>
</div>
<div class="paragraph">
<p><strong>There are 18 possible fixed-point types, but only 3 are listed below.</strong> The rest can be inferred from the tables above.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$00.00, $FF.FF]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-$8000.00, $7FFF.FF]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UFFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$00.000000, $FF.FFFFFF]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_numeric_constant_types">17.1.4. Numeric Constant Types</h4>
<div class="paragraph">
<p><code>Int</code> and <code>Real</code> are used for compile-time constants.</p>
</div>
<div class="paragraph">
<p>Literal expressions denoting integers, like <code>1234</code> or <code>$40</code>, have the type <code>Int</code>.
Likewise, literal expressions with a <code>.</code> to denote fractions, like <code>3.14</code>, <code>0.5</code>, or <code>100.0</code>, have the type <code>Real</code>.</p>
</div>
<div class="paragraph">
<p>Values of these types can only exist at compile-time.
Any attempt to use them at run-time will error.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-2147483648, 2147483647]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Real</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-$80000000.000000, $7FFFFFFF.FFFFFF]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In many cases, <code>Int</code> and <code>Real</code> implicitly convert to other numeric types based on context.
For example, when using <code>Int</code> or <code>Real</code> in an operator like <code>+</code>,
the value converts to match the other operand&#8217;s type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U(a) + Int(b) // 'b' will implicitly convert to type U.</pre>
</div>
</div>
<div class="paragraph">
<p>When converting <code>Real</code> to a smaller representation, the value will be rounded.
This is in contrast to other type conversions, which truncate.
The purpose of this rounding is to improve the accuracy of <code>Real</code> constants.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>U x = U(1.75)     // 'x' is set to 2 via rounding, NOT 1.
U x = U(UF(1.75)) // 'x' is set to 1 via truncation, NOT 2.</pre>
</div>
</div>
<div class="paragraph">
<p>Although <code>Int</code> and <code>Real</code> cannot be used at run-time,
it is very useful to use them at compile-time.
For example, you may use them to define numeric constants:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct Int MEANING_OF_LIFE = 42
ct Real PI = 3.14159265359
ct Real GOLDEN_RATIO= 1.61803398875</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type_bool">17.1.5. Bool</h4>
<div class="paragraph">
<p>The type <code>Bool</code> is short for "boolean", and represents the values <code>true</code> and <code>false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[<code>false</code>, <code>true</code>]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>Bool</code> type is space-inefficient, as each value takes a byte if stored in memory.
If you need lots of boolean values, it&#8217;s recommended to combine them into bit-field flags using an integer type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ct U IS_ALIVE  = 1 &lt;&lt; 0
ct U IS_MOVING = 1 &lt;&lt; 1
ct U IS_HAPPY  = 1 &lt;&lt; 2

fn example()
    U flags = 0
    flags |= IS_ALIVE   // set flags
    flags &amp;= ~IS_MOVING // clear flags
    if flags &amp; IS_HAPPY // test flags
        // . . .</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_void">17.1.6. Void</h4>
<div class="paragraph">
<p>The type <code>Void</code> represents no value.
Its purpose is to represent the return type of functions that return no value.</p>
</div>
<div class="paragraph">
<p>Note that you do not have to use the <code>Void</code> keyword,
as leaving the return type off of a function implies <code>Void</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type_arithmetic">17.2. Arithmetic Types</h3>
<div class="paragraph">
<p>Arithmetic types are defined as all <a href="#type_integer">integer types</a>, <a href="#type_fixed">fixed-point types</a>, and <a href="#type_bool"><code>Bool</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="type_quantity">17.3. Quantity Types</h3>
<div class="paragraph">
<p>Quantity types are types which can represent quantities.
They are defined as all <a href="#type_integer">integer types</a>, <a href="#type_fixed">fixed-point types</a>.</p>
</div>
<div class="sect3">
<h4 id="type_ptr">17.3.1. Pointer Types</h4>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Pointer_(computer_programming)">Pointer</a> types represent addresses.
Unlike pointers in other languages, pointers in NESFab can only point to <a href="#type_paa">pointer-addressible arrays</a>.</p>
</div>
<div class="paragraph">
<p>There are four types of pointers, listed below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
<th class="tableblock halign-left valign-top">Pointed-to Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0000, $FFFF]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CCC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$00:$0000, $FF:$FFFF]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0000, $FFFF]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MMM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$00:$0000, $FF:$FFFF]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Banked vs Unbanked</strong></p>
</div>
<div class="paragraph">
<p>The two-letter pointers represent a 16-bit address,
while the three-letter pointers represent a 16-bit address along with an 8-bit bank.</p>
</div>
<div class="paragraph">
<p><strong>Mutable vs Constant</strong></p>
</div>
<div class="paragraph">
<p>The letter <code>C</code> in the names stands for "constant", while <code>M</code> stands for "mutable".
It is possible to modify memory using <code>M</code> pointers, but not <code>C</code> pointers.
Commonly, <code>C</code> pointers are used for ROM data, while <code>M</code> pointers are used for RAM data.</p>
</div>
<div class="paragraph">
<p><strong>Groups</strong></p>
</div>
<div class="paragraph">
<p>Pointer types are associated with one or more groups,
and their values can only point to values of those groups.</p>
</div>
<div class="paragraph">
<p>To include a group in a pointer type, append the group name onto it.
For example, to create a pointer that can reference values belonging to the groups <code>/foo</code> and <code>/bar</code>, the syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CC/foo/bar</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type_address">17.3.2. Address Types</h4>
<div class="paragraph">
<p>The address type <code>AA</code> is used for 16-bit hardware addresses,
and has the same representation as <a href="#type_ptr">pointers</a>, ignoring <a href="#groups">groups</a>.
This type is used for inline assembly and hardware expressions.</p>
</div>
<div class="paragraph">
<p><code>AAA</code> behaves like <code>AA</code>, but has an additional byte which tracks the address&#8217;s bank.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Size (bytes)</th>
<th class="tableblock halign-left valign-top">Value range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$0000, $FFFF]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AAA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[$00:$0000, $FF:$FFFF]</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_arrays">17.4. Arrays</h3>
<div class="paragraph">
<p>NESFab has two kinds of <a href="https://en.wikipedia.org/wiki/Array_(data_structure)">array</a> types with different restrictions for each.
The first has value semantics and behaves like arrays do in other languages, but cannot be referenced by pointers.
The second can, but it very limited otherwise and can only represent elements of type U.</p>
</div>
<div class="sect3">
<h4 id="type_tea">17.4.1. Typed Element Arrays (TEAs)</h4>
<div class="paragraph">
<p>A TEA is an array of a specified type, of any size between 1 and 65536. Two TEA variables are shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    // Syntax is TYPE[SIZE]
    UU[10] a_tea_variable
    SomeStruct[1500] another_tea_variable</pre>
</div>
</div>
<div class="paragraph">
<p>At the type level, TEAs are strictly one-dimensional.
That is, one cannot have a TEA of a TEA.
The compiler will enforce this even if TEAs are hidden inside structs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct SomeStruct
    U[30] struct_tea

fn foo()
    U[10][20]      // Error! Can't have multi-dimensional TEAs
    SomeStruct[50] // Error! Can't have multi-dimensional TEAs</pre>
</div>
</div>
<div class="paragraph">
<p>A TEA value can be created using a cast.
The size can be left blank and the compiler will infer it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    U[3] small_tea = U[3](10, 20, 30) // Initialize with value
    U[] inferred_tea = U[](3, 1, 4)   // Inferred size</pre>
</div>
</div>
<div class="paragraph">
<p>TEAs are always copied by value.
To copy more or fewer elements, the TEA can be cast to a different size before copying.
When casting to a larger TEA, the new elements at the end of the TEA are zero-initialized.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    U[3] small_tea = U[3](10, 20, 30)
    U[3] copied_tea = small_array
    U[2] smaller_tea = U[2](small_tea)
    U[5] larger_tea  = U[5](small_tea)</pre>
</div>
</div>
<div class="paragraph">
<p>Operator <code>[]</code> or operator <code>{}</code> can be used to read or write the elements of a TEA value.
The indexing is zero-based.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[]</code> expects an index argument of type <code>U</code>, limiting it to the first 256 elements.</p>
</li>
<li>
<p><code>{}</code> expects an index argument of type <code>UU</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>fn example()
    UU[1500] a_tea_variable
    a_tea_variable[4] = 64   // Set the 5th element to 64.
    a_tea_variable{999} = 10 // Set the 1000th element to 10.
    a_tea_variable[999] = 10 // Error! 999 can't convert to type U.</pre>
</div>
</div>
<div class="paragraph">
<p>The rationale for two different indexing operators is performance;
in general, <code>[]</code> executes significantly faster than <code>{}</code>,
as the NES only supports 8-bit indexing natively.</p>
</div>
<div class="paragraph">
<p>Note that in some cases, the compiler will be able to optimize operator <code>{}</code> to take advantage of 8-bit indexing on the NES&#8217;s hardware.
One such pattern it recognizes is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tea{U(index) + CONSTANT}</pre>
</div>
</div>
<div class="paragraph">
<p>But in general, one should prefer to use <code>[]</code>, with TEAs of size 256 or less.</p>
</div>
</div>
<div class="sect3">
<h4 id="type_paa">17.4.2. Pointer-Addressable Arrays (PAAs)</h4>
<div class="paragraph">
<p>PAAs only support a single element type: <code>U</code>, and can only be defined at global scope.
Like TEAs, they can be any size from 1 to 65536.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /example
    // Syntax is [SIZE]
    // (You do not specify a type, as it is always type U)
    [10] a_paa
    [1500] another_paa

fn example([100] bad_param) // Error! Cannot use PAAs as fn parameters
    [100] bad_variable      // Error! Cannot use PAAs as local variables</pre>
</div>
</div>
<div class="paragraph">
<p>PAAs cannot be created using casts and there is no support for copying them.</p>
</div>
<div class="paragraph">
<p>Like TEAs, operator <code>[]</code> or operator <code>{}</code> can be used to read or write the elements of a TEA value.
The indexing is zero-based.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[]</code> expects an index argument of type <code>U</code>, limiting it to the first 256 elements.</p>
</li>
<li>
<p><code>{}</code> expects an index argument of type <code>UU</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>vars /example
    [10] a_paa

fn example()
    MM/example ptr = @a_paa // Get a pointer to 'a_paa'</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="type_struct">17.5. Structures</h3>
<div class="paragraph">
<p>Structures (or "structs") are <a href="https://en.wikipedia.org/wiki/Record_(computer_science)">record types</a>,
which allows one to aggregate multiple types into a single one.</p>
</div>
<div class="paragraph">
<p>See <a href="#kw_struct"><code>struct</code></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-03-09 13:00:31 -0600
</div>
</div>
</body>
</html>